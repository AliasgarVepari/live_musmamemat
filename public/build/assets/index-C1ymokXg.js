import{r as d,a as oe,u as de,j as e,H as I,L as ue,b as L}from"./app-CYM3PNp1.js";import{B as x}from"./badge-Diu093LN.js";import{B as h}from"./button-C7nw6qcu.js";import{C as j,a as T,b as B,d as F,c as g}from"./card-fs3rVVQQ.js";import{I as me}from"./input-DXQNqKBk.js";import{S as f,a as v,b as N,c as b,d as r}from"./select-B7xDJWvB.js";import{U as R,a as V,S as xe,b as he,c as pe}from"./suspension-dialog-CDz-uyTb.js";import{u as je}from"./use-cached-pagination-BlKh_MAo.js";import{T as ge}from"./textarea-VKzoi5qW.js";import{u as fe}from"./use-error-handler-BEvk4a9K.js";import{A as z,U as ve}from"./app-layout-3e2Nwvxm.js";import{F as Ne}from"./filter-D-ldOTW8.js";import{S as be}from"./search-CV99GWnC.js";import{U as ye}from"./user-DUWpCqQX.js";import{E as Se}from"./eye-CWQwS0J3.js";import{T as H}from"./trash-2-DoNEwY_E.js";import{S as we}from"./shield-5WKs1NcE.js";import"./index-5_OapAfH.js";import"./index-C5HyJD3C.js";import"./index-BdQq_4o_.js";import"./index-lGUcocfo.js";import"./index-D1RNmNR_.js";import"./check-25m0aqsS.js";import"./dialog-D6gXA9tz.js";import"./label-Dz2O3nKd.js";import"./index-BjeYhCr2.js";import"./useQuery-Bj3j9lpv.js";import"./chevron-right-rarKV8wF.js";import"./index-dfFKHXjz.js";import"./index-DW9AIAM8.js";import"./base-layout-CEx8z9PL.js";/* empty css            */import"./use-forced-theme-Bq8pa95d.js";import"./settings-BDBjvKmM.js";import"./logo-DB6pQEXk.js";import"./map-pin--_Eww1hY.js";import"./crown-Bbso2q9j.js";const O=[{title:"Users",href:"/admin/users"}];function cs({users:A,governorates:W,filters:u}){const[X,y]=d.useState(!1),[S,E]=d.useState(null),[q,w]=d.useState(!1),[G,_]=d.useState(!1),[C,D]=d.useState(null);fe();const{url:J}=oe(),{data:P,setData:U,delete:K,processing:$}=de({deletion_reason:""}),{data:Q,isLoading:Y,paginationState:i,goToPage:k,setPerPage:Z,setSearch:ee,updateFilter:M,refetch:m}=je({endpoint:"/admin/users",initialPage:A.current_page,initialPerPage:u.per_page||"20",initialSearch:u.search||"",initialFilters:{subscription_status:u.subscription_status||"all",status:u.status||"all",governorate_id:u.governorate_id||"all"}});d.useEffect(()=>{localStorage.getItem("admin-users-refresh")==="true"&&(localStorage.removeItem("admin-users-refresh"),setTimeout(()=>{m()},100))},[J,m]);const t=Q||A;if(Y&&!t)return e.jsxs(z,{breadcrumbs:O,children:[e.jsx(I,{title:"Users Management"}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 overflow-x-auto rounded-xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})})]});const se=s=>{s.status==="active"?(E(s),y(!0)):L.patch(`/admin/users/${s.id}/toggle`,{},{onSuccess:()=>{m()},onError:a=>{const n=Object.values(a).flat().join(", ");alert(`Error: ${n}`)}})},te=s=>{S&&(w(!0),L.patch(`/admin/users/${S.id}/suspend`,{suspension_reason:s},{onSuccess:()=>{w(!1),y(!1),E(null),m()},onError:a=>{w(!1);const n=Object.values(a).flat().join(", ");alert(`Error: ${n}`)}}))},ae=s=>{D(s),_(!0)},re=s=>{s.preventDefault(),C&&K(`/admin/users/${C.id}`,{onSuccess:()=>{_(!1),D(null),U("deletion_reason",""),localStorage.setItem("admin-users-refresh","true"),m()},onError:a=>{const n=Object.values(a).flat().join(", ");alert(`Error: ${n}`)}})},le=s=>{const a={active:{variant:"default",icon:V,text:"Active"},suspended:{variant:"secondary",icon:R,text:"Suspended"},deleted:{variant:"outline",icon:H,text:"Deleted"}},l=a[s]||a.active,n=l.icon;return e.jsxs(x,{variant:l.variant,className:"flex items-center gap-1",children:[e.jsx(n,{className:"h-3 w-3"}),l.text]})},ne=s=>{if(!s.subscription)return e.jsx(x,{variant:"outline",children:"No Subscription"});const a=new Date(s.subscription.expires_at)<new Date;return s.subscription.is_active&&!a?e.jsxs(x,{variant:"default",className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),s.subscription.plan.name]}):a?e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),"Expired"]}):e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"Inactive"]})};return e.jsxs(z,{breadcrumbs:O,children:[e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Users Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Users Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, subscriptions, and permissions"})]})}),e.jsxs(j,{children:[e.jsxs(T,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Filters"]}),e.jsx(F,{children:"Search and filter users by various criteria"})]}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"text-muted-foreground absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2"}),e.jsx(me,{placeholder:"Search users...",value:i.search,onChange:s=>ee(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Subscription"}),e.jsxs(f,{value:i.filters.subscription_status,onValueChange:s=>M("subscription_status",s),children:[e.jsx(v,{children:e.jsx(N,{placeholder:"All subscriptions"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All subscriptions"}),e.jsx(r,{value:"subscribed",children:"Subscribed"}),e.jsx(r,{value:"expired",children:"Expired"}),e.jsx(r,{value:"unsubscribed",children:"Unsubscribed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(f,{value:i.filters.status,onValueChange:s=>M("status",s),children:[e.jsx(v,{children:e.jsx(N,{placeholder:"All statuses"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All statuses"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"suspended",children:"Suspended"}),e.jsx(r,{value:"deleted",children:"Deleted"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Governorate"}),e.jsxs(f,{value:i.filters.governorate_id,onValueChange:s=>M("governorate_id",s),children:[e.jsx(v,{children:e.jsx(N,{placeholder:"All governorates"})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"All governorates"}),W.map(s=>e.jsx(r,{value:s.id.toString(),children:s.name_en},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Records per page"}),e.jsxs(f,{value:i.perPage,onValueChange:Z,children:[e.jsx(v,{children:e.jsx(N,{placeholder:"Records per page"})}),e.jsxs(b,{children:[e.jsx(r,{value:"5",children:"5"}),e.jsx(r,{value:"10",children:"10"}),e.jsx(r,{value:"20",children:"20"}),e.jsx(r,{value:"50",children:"50"}),e.jsx(r,{value:"100",children:"100"})]})]})]})]})})]}),e.jsx("div",{className:"grid gap-4",children:t?.data?.map(s=>e.jsx(j,{className:"transition-shadow hover:shadow-md",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-primary/10 flex h-12 w-12 items-center justify-center rounded-full",children:e.jsx(ye,{className:"text-primary h-6 w-6"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name_en}),le(s.status),ne(s)]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.email}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.phone}),s.governorate&&e.jsx("p",{className:"text-muted-foreground text-sm",children:s.governorate.name_en})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-muted-foreground text-right text-sm",children:[e.jsxs("div",{children:[s.ads_count," ads"]}),e.jsxs("div",{children:[s.ad_views_count," views"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(h,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(ue,{href:`/admin/users/${s.id}`,children:e.jsx(Se,{className:"h-4 w-4"})})}),s.status!=="deleted"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>se(s),children:s.status==="active"?e.jsx(R,{className:"h-4 w-4"}):e.jsx(V,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ae(s),className:"text-destructive hover:text-destructive",children:e.jsx(H,{className:"h-4 w-4"})})]})]})]})]})})},s.id))}),t?.data?.length===0&&e.jsx(j,{children:e.jsxs(g,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ve,{className:"mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"text-center text-gray-500",children:i.search||i.filters.subscription_status!=="all"||i.filters.status!=="all"||i.filters.governorate_id!=="all"?"No users match your current filters.":"No users have registered yet. Users will appear here once they sign up."})]})}),t?.data&&t.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs("div",{className:"text-base font-medium text-gray-700",children:[t.from," - ",t.to," of ",t.total," users"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>k(t.current_page-1),disabled:t.current_page<=1,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${t.current_page>1?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const s=t.current_page,a=t.last_page,l=2,n=[],c=[];for(let o=Math.max(2,s-l);o<=Math.min(a-1,s+l);o++)n.push(o);return s-l>2?c.push(1,"..."):c.push(1),c.push(...n),a>1&&(s+l<a-1?c.push("...",a):n.includes(a)||c.push(a)),c.map((o,ie)=>{if(o==="...")return e.jsx("span",{className:"text-muted-foreground px-2",children:"..."},`dots-${ie}`);const p=o,ce=p===s;return e.jsx("button",{onClick:()=>k(p),className:`flex h-10 w-10 items-center justify-center rounded-full text-base font-medium transition-colors ${ce?"bg-black text-white":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"}`,children:p},p)})})()}),e.jsx("button",{onClick:()=>k(t.current_page+1),disabled:t.current_page>=t.last_page,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${t.current_page<t.last_page?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})]})]}),e.jsx(xe,{open:X,onOpenChange:y,onConfirm:te,userName:S?.name_en||"",isSuspending:q}),G&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs(T,{children:[e.jsx(B,{children:"Delete User Account"}),e.jsxs(F,{children:["This will permanently delete ",C?.name_en,"'s account"]})]}),e.jsx(g,{children:e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Reason for deletion"}),e.jsx(ge,{id:"deletion_reason",value:P.deletion_reason,onChange:s=>U("deletion_reason",s.target.value),placeholder:"Provide reason for deleting account",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>{_(!1),D(null),U("deletion_reason","")},children:"Cancel"}),e.jsx(h,{type:"submit",variant:"destructive",disabled:$||!P.deletion_reason.trim(),children:$?"Deleting...":"Delete Account"})]})]})})]})})]})}export{cs as default};
