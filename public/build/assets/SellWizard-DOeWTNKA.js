import{d as R,r as m,j as e,g as Q,P as M,c as ee,f as Qe,e as te,h as Z,k as et,i as tt,n as L,T as rt,C as st,b as k,m as at}from"./app-uIBbFV7s.js";import{L as it,a as z,B as A,D as ot,d as nt,e as ct,f as lt,H as dt,F as ut,o as pt,A as mt,C as ft}from"./Header-CBnxxvlh.js";import{f as pe,u as ht,g as gt,I as xt}from"./index-B66VouJH.js";import{u as bt}from"./index-D11fCLcl.js";import{S as yt}from"./shopping-bag-BXRFYlJC.js";import{H as me,Z as fe,P as vt}from"./ProductDetails-B2XGKOOI.js";import{P as _t}from"./package-B21yyitO.js";import{C as re,a as he}from"./card-CRPh_RWT.js";import{C as ge}from"./check-BKj3NmhL.js";import{S as V}from"./star-Bbywy0m0.js";import{C as xe}from"./crown-CRR7HS9B.js";import{C as jt}from"./credit-card-C4dsvzva.js";import{E as Nt}from"./eye-CWVhv2BV.js";import{P as St}from"./plus-2LA9Ba3C.js";import{U as wt}from"./user-layout-CPhqkvt1.js";import{C as kt}from"./chevron-right-BwP0sTl-.js";import"./useQuery-BOwQyM-Z.js";import"./phone-BlRnQl2Q.js";import"./index-CZeLxcXh.js";import"./index-CW_uxFBv.js";import"./index-7_aMnH8U.js";import"./loader-circle-8zL-8vl0.js";import"./search-C9k4RQzq.js";import"./user-Boxb24vn.js";import"./select-C4szj2fj.js";import"./index-C87z0twV.js";import"./index-BdQq_4o_.js";import"./index-DfaiIYQt.js";import"./upload-D-iVhWHy.js";import"./use-forced-theme-BDmHQh6w.js";/* empty css            *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]],Ct=R("Baby",$t);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Rt=R("Circle",Pt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],At=R("Gamepad2",Et);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]],Dt=R("Gem",It);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],Mt=R("Plane",Tt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],Ft=R("Shirt",Lt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Ot=R("Smartphone",Ut);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],zt=R("Sparkles",Bt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]],Kt=R("Watch",Gt);var se="Progress",ae=100,[Ht,Wr]=Q(se),[Vt,Wt]=Ht(se),be=m.forwardRef((o,i)=>{const{__scopeProgress:t,value:r=null,max:u,getValueLabel:f=qt,...b}=o;(u||u===0)&&!de(u)&&console.error(Xt(`${u}`,"Progress"));const l=de(u)?u:ae;r!==null&&!ue(r,l)&&console.error(Yt(`${r}`,"Progress"));const y=ue(r,l)?r:null,h=W(y)?f(y,l):void 0;return e.jsx(Vt,{scope:t,value:y,max:l,children:e.jsx(M.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":W(y)?y:void 0,"aria-valuetext":h,role:"progressbar","data-state":_e(y,l),"data-value":y??void 0,"data-max":l,...b,ref:i})})});be.displayName=se;var ye="ProgressIndicator",ve=m.forwardRef((o,i)=>{const{__scopeProgress:t,...r}=o,u=Wt(ye,t);return e.jsx(M.div,{"data-state":_e(u.value,u.max),"data-value":u.value??void 0,"data-max":u.max,...r,ref:i})});ve.displayName=ye;function qt(o,i){return`${Math.round(o/i*100)}%`}function _e(o,i){return o==null?"indeterminate":o===i?"complete":"loading"}function W(o){return typeof o=="number"}function de(o){return W(o)&&!isNaN(o)&&o>0}function ue(o,i){return W(o)&&!isNaN(o)&&o<=i&&o>=0}function Xt(o,i){return`Invalid prop \`max\` of value \`${o}\` supplied to \`${i}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ae}\`.`}function Yt(o,i){return`Invalid prop \`value\` of value \`${o}\` supplied to \`${i}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ae} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var je=be,Jt=ve;const Ne=m.forwardRef(({className:o,value:i,...t},r)=>e.jsx(je,{ref:r,className:ee("relative h-4 w-full overflow-hidden rounded-full bg-secondary",o),...t,children:e.jsx(Jt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(i||0)}%)`}})}));Ne.displayName=je.displayName;var ie="Radio",[Zt,Se]=Q(ie),[Qt,er]=Zt(ie),we=m.forwardRef((o,i)=>{const{__scopeRadio:t,name:r,checked:u=!1,required:f,disabled:b,value:l="on",onCheck:y,form:h,...v}=o,[_,j]=m.useState(null),N=te(i,c=>j(c)),n=m.useRef(!1),a=_?h||!!_.closest("form"):!0;return e.jsxs(Qt,{scope:t,checked:u,disabled:b,children:[e.jsx(M.button,{type:"button",role:"radio","aria-checked":u,"data-state":Pe(u),"data-disabled":b?"":void 0,disabled:b,value:l,...v,ref:N,onClick:Z(o.onClick,c=>{u||y?.(),a&&(n.current=c.isPropagationStopped(),n.current||c.stopPropagation())})}),a&&e.jsx(Ce,{control:_,bubbles:!n.current,name:r,value:l,checked:u,required:f,disabled:b,form:h,style:{transform:"translateX(-100%)"}})]})});we.displayName=ie;var ke="RadioIndicator",$e=m.forwardRef((o,i)=>{const{__scopeRadio:t,forceMount:r,...u}=o,f=er(ke,t);return e.jsx(et,{present:r||f.checked,children:e.jsx(M.span,{"data-state":Pe(f.checked),"data-disabled":f.disabled?"":void 0,...u,ref:i})})});$e.displayName=ke;var tr="RadioBubbleInput",Ce=m.forwardRef(({__scopeRadio:o,control:i,checked:t,bubbles:r=!0,...u},f)=>{const b=m.useRef(null),l=te(b,f),y=bt(t),h=tt(i);return m.useEffect(()=>{const v=b.current;if(!v)return;const _=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(_,"checked").set;if(y!==t&&N){const n=new Event("click",{bubbles:r});N.call(v,t),v.dispatchEvent(n)}},[y,t,r]),e.jsx(M.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...u,tabIndex:-1,ref:l,style:{...u.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ce.displayName=tr;function Pe(o){return o?"checked":"unchecked"}var rr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],q="RadioGroup",[sr,qr]=Q(q,[pe,Se]),Re=pe(),Ee=Se(),[ar,ir]=sr(q),Ae=m.forwardRef((o,i)=>{const{__scopeRadioGroup:t,name:r,defaultValue:u,value:f,required:b=!1,disabled:l=!1,orientation:y,dir:h,loop:v=!0,onValueChange:_,...j}=o,N=Re(t),n=ht(h),[a,c]=Qe({prop:f,defaultProp:u??null,onChange:_,caller:q});return e.jsx(ar,{scope:t,name:r,required:b,disabled:l,value:a,onValueChange:c,children:e.jsx(gt,{asChild:!0,...N,orientation:y,dir:n,loop:v,children:e.jsx(M.div,{role:"radiogroup","aria-required":b,"aria-orientation":y,"data-disabled":l?"":void 0,dir:n,...j,ref:i})})})});Ae.displayName=q;var Ie="RadioGroupItem",De=m.forwardRef((o,i)=>{const{__scopeRadioGroup:t,disabled:r,...u}=o,f=ir(Ie,t),b=f.disabled||r,l=Re(t),y=Ee(t),h=m.useRef(null),v=te(i,h),_=f.value===u.value,j=m.useRef(!1);return m.useEffect(()=>{const N=a=>{rr.includes(a.key)&&(j.current=!0)},n=()=>j.current=!1;return document.addEventListener("keydown",N),document.addEventListener("keyup",n),()=>{document.removeEventListener("keydown",N),document.removeEventListener("keyup",n)}},[]),e.jsx(xt,{asChild:!0,...l,focusable:!b,active:_,children:e.jsx(we,{disabled:b,required:f.required,checked:_,...y,...u,name:f.name,ref:v,onCheck:()=>f.onValueChange(u.value),onKeyDown:Z(N=>{N.key==="Enter"&&N.preventDefault()}),onFocus:Z(u.onFocus,()=>{j.current&&h.current?.click()})})})});De.displayName=Ie;var or="RadioGroupIndicator",Te=m.forwardRef((o,i)=>{const{__scopeRadioGroup:t,...r}=o,u=Ee(t);return e.jsx($e,{...u,...r,ref:i})});Te.displayName=or;var Me=Ae,Le=De,nr=Te;const Fe=m.forwardRef(({className:o,...i},t)=>e.jsx(Me,{className:ee("grid gap-2",o),...i,ref:t}));Fe.displayName=Me.displayName;const Ue=m.forwardRef(({className:o,...i},t)=>e.jsx(Le,{ref:t,className:ee("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",o),...i,children:e.jsx(nr,{className:"flex items-center justify-center",children:e.jsx(Rt,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ue.displayName=Le.displayName;const cr=(o,i)=>{const t=o.toLowerCase(),r=i.toLowerCase();return t.includes("handbag")||t.includes("bag")||r.includes("handbag")||r.includes("bag")?yt:t.includes("clothing")||t.includes("clothes")||t.includes("shirt")||r.includes("clothing")||r.includes("clothes")?Ft:t.includes("jewelry")||t.includes("jewellery")||t.includes("gem")||r.includes("jewelry")||r.includes("jewellery")?Dt:t.includes("watch")||t.includes("watches")||r.includes("watch")||r.includes("watches")?Kt:t.includes("beauty")||t.includes("care")||r.includes("beauty")||r.includes("care")?zt:t.includes("children")||t.includes("baby")||r.includes("children")||r.includes("baby")?Ct:t.includes("gaming")||t.includes("game")||r.includes("gaming")||r.includes("game")?At:t.includes("phone")||t.includes("mobile")||r.includes("phone")||r.includes("mobile")?Ot:t.includes("travel")||t.includes("plane")||r.includes("travel")||r.includes("plane")?Mt:t.includes("home")||t.includes("garden")||r.includes("home")||r.includes("garden")?me:_t},lr=({formData:o,updateFormData:i})=>{const{language:t,t:r}=L(),[u,f]=m.useState([]),[b,l]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const _=await(await fetch("/api/user/categories")).json();f(_.categories||_)}catch(v){console.error("Error loading categories:",v)}finally{l(!1)}})()},[]);const y=h=>{i({category_id:parseInt(h)})};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:t==="ar"?"font-arabic":"",children:t==="ar"?"جاري تحميل الفئات...":"Loading categories..."})]})}):e.jsxs("div",{className:`space-y-6 ${t==="ar"?"rtl":"ltr"}`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:`text-lg font-semibold mb-2 ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"اختر فئة المنتج":"Select Product Category"}),e.jsx("p",{className:`text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"اختر الفئة التي تنتمي إليها منتجك":"Choose the category that best fits your product"})]}),e.jsx(Fe,{value:o.category_id?.toString()||"",onValueChange:y,className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(h=>{const v=t==="ar"?h.name_ar:h.name_en,_=cr(v,h.slug),j=o.category_id===h.id;return e.jsxs("div",{children:[e.jsx(Ue,{value:h.id.toString(),id:`category-${h.id}`,className:"peer sr-only"}),e.jsxs(it,{htmlFor:`category-${h.id}`,onClick:()=>y(h.id.toString()),className:`group flex flex-col items-center justify-center p-6 border-2 rounded-lg cursor-pointer transition-all ${j?"border-primary bg-primary/10 shadow-md":"border-muted-foreground/25 hover:border-primary hover:bg-primary/5"}`,children:[e.jsx("div",{className:`mb-3 p-3 rounded-full transition-all ${j?"bg-primary text-white":"bg-muted/20 text-muted-foreground group-hover:bg-primary group-hover:text-white"}`,children:h.icon_url?e.jsx("img",{src:h.icon_url,alt:v,className:`h-12 w-12 object-contain transition-all ${j?"brightness-0 invert":"group-hover:brightness-0 group-hover:invert"}`}):e.jsx(_,{className:"h-12 w-12"})}),e.jsx("span",{className:`text-sm font-medium text-center ${t==="ar"?"font-arabic":""} ${j?"text-primary":""}`,children:v})]})]},h.id)})})]})},dr=({formData:o,updateFormData:i})=>{const{language:t,t:r}=L(),[u,f]=m.useState([]),[b,l]=m.useState(null),[y,h]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const c=await(await fetch("/api/user/subscription-plans")).json(),w=c.data||c,s=localStorage.getItem("authToken");if(s){const D=await fetch("/api/user/subscription",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(D.ok){const F=await D.json();F.success&&l(F.data)}}f(w)}catch(a){console.error("Error loading data:",a);const w=await(await fetch("/api/user/subscription-plans")).json();f(w.data||w)}finally{h(!1)}})()},[]);const v=n=>{console.log("SelectSubscription: handlePlanSelect called with planId:",n),i({subscription_plan_id:n}),console.log("SelectSubscription: updateFormData called with subscription_plan_id:",n)},_=n=>t==="ar"?n.name_ar:n.name_en,j=n=>{const a=[];return n.ad_limit>0&&(t==="ar"?a.push(`${n.ad_limit} إعلان شهرياً`):a.push(`${n.ad_limit} ads per month`)),n.has_unlimited_featured_ads?t==="ar"?a.push("إعلانات مميزة غير محدودة"):a.push("Unlimited featured ads"):n.featured_ads_count&&n.featured_ads_count>0&&(t==="ar"?a.push(`${n.featured_ads_count} إعلان مميز`):a.push(`${n.featured_ads_count} featured ads`)),n.priority_support&&(t==="ar"?a.push("دعم أولوي"):a.push("Priority support")),n.analytics&&(t==="ar"?a.push("تحليلات متقدمة"):a.push("Analytics")),n.is_lifetime&&(t==="ar"?a.push("اشتراك مدى الحياة"):a.push("Lifetime subscription")),a.length===0&&(t==="ar"?(a.push("إعلانات أساسية"),a.push("دعم قياسي")):(a.push("Basic listings"),a.push("Standard support"))),a},N=n=>{const a=_(n).toLowerCase();return a.includes("free")||a.includes("مجاني")?fe:a.includes("silver")||a.includes("فضي")?V:a.includes("gold")||a.includes("ذهبي")?xe:V};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:t==="ar"?"font-arabic":"",children:t==="ar"?"جاري تحميل خطط الاشتراك...":"Loading subscription plans..."})]})}):e.jsxs("div",{className:`flex flex-col h-full ${t==="ar"?"rtl":"ltr"}`,children:[e.jsx("div",{className:"flex-1 space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(n=>{N(n);const a=o.subscription_plan_id===n.id,c=j(n);return e.jsx(re,{className:`flex flex-col h-full cursor-pointer transition-all hover:shadow-lg ${a?"ring-2 ring-primary border-primary":"hover:border-primary/50"}`,onClick:()=>v(n.id),children:e.jsxs(he,{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h4",{className:`text-lg font-semibold mb-1 ${t==="ar"?"font-arabic":""}`,children:_(n)}),(n.description_en||n.description_ar)&&e.jsx("p",{className:`text-sm text-muted-foreground mb-3 ${t==="ar"?"font-arabic":""}`,children:t==="ar"?n.description_ar:n.description_en}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("span",{className:`text-2xl font-bold ${t==="ar"?"font-arabic":""}`,children:n.price===0?t==="ar"?"مجاني":"Free":`KD ${n.price}`}),n.price>0&&e.jsx("span",{className:`text-sm text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:n.is_lifetime?t==="ar"?"مدى الحياة":"Lifetime":`/${n.months_count} ${t==="ar"?"شهر":"months"}`})]}),n.price>0&&e.jsx(z,{variant:"secondary",className:"mb-4",children:t==="ar"?"مدفوع":"Paid"})]}),c.length>0&&e.jsx("ul",{className:"space-y-2 flex-1",children:c.map((w,s)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:`text-sm ${t==="ar"?"font-arabic":""}`,children:w.trim()})]},s))}),e.jsx(A,{className:`w-full mt-4 ${a?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-primary hover:text-primary-foreground"}`,variant:a?"default":"outline",onClick:w=>{w.stopPropagation(),console.log("SelectSubscription: Button clicked for plan:",n.id),v(n.id)},children:a?t==="ar"?"محدد":"Selected":t==="ar"?"اختر هذه الخطة":"Select This Plan"})]})},n.id)})})}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:`text-sm text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"يمكنك تغيير خطة الاشتراك في أي وقت من إعدادات الحساب":"You can change your subscription plan anytime from account settings"})})]})},ur=({formData:o,updateFormData:i,currentSubscription:t})=>{const{language:r,t:u}=L(),[f,b]=m.useState([]),[l,y]=m.useState(null),[h,v]=m.useState(!0);m.useEffect(()=>{console.log("SelectUpgradeSubscription"),(async()=>{try{const c=localStorage.getItem("authToken");if(!c)return;const s=await(await fetch("/api/user/subscription-plans/upgrade-options",{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).json();s.success&&(b(s.data||[]),y(s.current_plan))}catch(c){console.error("Error loading upgrade plans:",c)}finally{v(!1)}})()},[t]);const _=a=>{i({subscription_plan_id:a})},j=a=>r==="ar"?a.name_ar:a.name_en,N=a=>{const c=[];return a.ad_limit>0&&(r==="ar"?c.push(`${a.ad_limit} إعلان شهرياً`):c.push(`${a.ad_limit} ads per month`)),a.has_unlimited_featured_ads?r==="ar"?c.push("إعلانات مميزة غير محدودة"):c.push("Unlimited featured ads"):a.featured_ads_count&&a.featured_ads_count>0&&(r==="ar"?c.push(`${a.featured_ads_count} إعلان مميز`):c.push(`${a.featured_ads_count} featured ads`)),a.priority_support&&(r==="ar"?c.push("دعم أولوي"):c.push("Priority support")),a.analytics&&(r==="ar"?c.push("تحليلات متقدمة"):c.push("Advanced analytics")),a.readable_billing_cycle&&(r==="ar"?c.push(`دورة فوترة: ${a.readable_billing_cycle}`):c.push(`Billing: ${a.readable_billing_cycle}`)),a.is_lifetime&&(r==="ar"?c.push("اشتراك مدى الحياة"):c.push("Lifetime subscription")),c.length===0&&(r==="ar"?(c.push("إعلانات أساسية"),c.push("دعم قياسي")):(c.push("Basic listings"),c.push("Standard support"))),c},n=a=>{const c=j(a).toLowerCase();return c.includes("free")||c.includes("مجاني")?fe:c.includes("silver")||c.includes("فضي")?V:c.includes("gold")||c.includes("ذهبي")?xe:V};return h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:r==="ar"?"font-arabic":"",children:r==="ar"?"جاري تحميل خطط الترقية...":"Loading upgrade plans..."})]})}):e.jsxs("div",{className:`flex flex-col h-full ${r==="ar"?"rtl":"ltr"}`,children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[l&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:`text-lg font-semibold mb-3 ${r==="ar"?"font-arabic":""}`,children:r==="ar"?"خطة الاشتراك الحالية":"Current Subscription Plan"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium text-lg ${r==="ar"?"font-arabic":""}`,children:r==="ar"?l.name_ar:l.name_en}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("p",{className:`text-sm text-muted-foreground ${r==="ar"?"font-arabic":""}`,children:r==="ar"?`${l.ad_limit} إعلان شهرياً`:`${l.ad_limit} ads per month`}),e.jsxs("p",{className:`text-sm font-medium ${r==="ar"?"font-arabic":""}`,children:["KD ",l.price]})]})]}),e.jsx(z,{variant:"outline",className:"ml-4",children:r==="ar"?"نشط":"Active"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(a=>{n(a);const c=o.subscription_plan_id===a.id,w=N(a);return e.jsx(re,{className:`flex flex-col h-full cursor-pointer transition-all hover:shadow-lg ${c?"ring-2 ring-primary border-primary":"hover:border-primary/50"}`,onClick:()=>_(a.id),children:e.jsxs(he,{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h4",{className:`text-lg font-semibold mb-1 ${r==="ar"?"font-arabic":""}`,children:j(a)}),(a.description_en||a.description_ar)&&e.jsx("p",{className:`text-sm text-muted-foreground mb-3 ${r==="ar"?"font-arabic":""}`,children:r==="ar"?a.description_ar:a.description_en}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[t?.plan.is_lifetime?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-2xl font-bold ${r==="ar"?"font-arabic":""}`,children:a.price===0?r==="ar"?"مجاني":"Free":`KD ${a.price}`}),e.jsx(z,{variant:"outline",className:"mt-1 text-xs",children:r==="ar"?"لا يوجد خصم للخطط الدائمة":"No discount for lifetime plans"})]}):a.discounted_price!==void 0&&a.original_price!==void 0&&a.discounted_price<a.original_price?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-2xl font-bold text-green-600 ${r==="ar"?"font-arabic":""}`,children:["KD ",a.discounted_price.toFixed(2)]}),e.jsxs("span",{className:`text-lg line-through text-muted-foreground ${r==="ar"?"font-arabic":""}`,children:["KD ",a.original_price]})]}),e.jsx(z,{variant:"destructive",className:"mt-1",children:r==="ar"?`وفر KD ${a.discount_amount?.toFixed(2)}`:`Save KD ${a.discount_amount?.toFixed(2)}`})]}):e.jsx("span",{className:`text-2xl font-bold ${r==="ar"?"font-arabic":""}`,children:a.price===0?r==="ar"?"مجاني":"Free":`KD ${a.price}`}),a.price>0&&e.jsx("span",{className:`text-sm text-muted-foreground ${r==="ar"?"font-arabic":""}`,children:a.is_lifetime?r==="ar"?"مدى الحياة":"Lifetime":`/${a.months_count} ${r==="ar"?"شهر":"months"}`})]}),a.price>0&&e.jsx(z,{variant:"secondary",className:"mb-4",children:r==="ar"?"مدفوع":"Paid"})]}),w.length>0&&e.jsx("ul",{className:"space-y-2 flex-1",children:w.map((s,D)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:`text-sm ${r==="ar"?"font-arabic":""}`,children:s.trim()})]},D))}),e.jsx(A,{className:`w-full mt-4 ${c?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-primary hover:text-primary-foreground"}`,variant:c?"default":"outline",children:c?r==="ar"?"محدد":"Selected":r==="ar"?"اختر هذه الخطة":"Select This Plan"})]})},a.id)})})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:`text-sm text-muted-foreground ${r==="ar"?"font-arabic":""}`,children:r==="ar"?"سيتم حساب الخصم بناءً على الأيام المتبقية في اشتراكك الحالي":"Discount will be calculated based on remaining days in your current subscription"})})]})},pr=({isOpen:o,onClose:i,onUpgrade:t,onGoHome:r,upgradeEligible:u=null,upgradeError:f="",checkingEligibility:b=!1})=>{const{language:l,t:y}=L();return e.jsx(ot,{open:o,onOpenChange:i,children:e.jsxs(nt,{className:"w-[95vw] max-w-lg max-h-[90vh] overflow-y-auto mx-auto my-4 sm:my-0",children:[e.jsx(ct,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(rt,{className:"w-8 h-8 text-orange-600"})}),e.jsx("div",{className:"w-full",children:e.jsx(lt,{className:`text-xl sm:text-2xl font-bold text-gray-900 leading-tight ${l==="ar"?"font-arabic":""}`,children:l==="ar"?"تم استنفاد حد الإعلانات":"Ad Limit Exhausted"})})]})}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:`text-sm sm:text-base text-gray-600 leading-relaxed text-center px-2 ${l==="ar"?"font-arabic":""}`,children:l==="ar"?"لقد وصلت إلى الحد الأقصى من الإعلانات لهذا الشهر. يمكنك المحاولة مرة أخرى الشهر القادم أو ترقية اشتراكك للحصول على المزيد من الإعلانات.":"Your ad limit for this month has been exhausted. You can try adding next month or upgrade your subscription to get more ads."}),b?e.jsx("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200 text-center mx-2",children:e.jsx("p",{className:`text-sm text-blue-700 ${l==="ar"?"font-arabic":""}`,children:l==="ar"?"جاري التحقق من الأهلية...":"Checking eligibility..."})}):u!==null&&e.jsx("div",{className:`p-4 rounded-lg text-center mx-2 ${u?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm font-medium leading-relaxed ${u?"text-green-700":"text-red-700"} ${l==="ar"?"font-arabic":""}`,children:u?l==="ar"?"يمكنك ترقية اشتراكك":"You are eligible for upgrade":f||(l==="ar"?"لا يمكنك ترقية اشتراكك":"No upgrade options available. You already have the highest plan or no better plans exist.")})}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2 px-2",children:[e.jsxs(A,{variant:"outline",onClick:r,className:"flex items-center justify-center gap-2 w-full h-14 border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 touch-manipulation",children:[e.jsx(me,{className:"w-5 h-5"}),e.jsx("span",{className:`font-medium text-base ${l==="ar"?"font-arabic":""}`,children:l==="ar"?"إلغاء الإدراج والعودة للرئيسية":"Cancel Listing and Go Home"})]}),e.jsx(A,{onClick:t,disabled:b||u===!1,className:`flex items-center justify-center gap-2 w-full h-14 font-medium text-base touch-manipulation ${b||u===!1?"bg-gray-400 text-gray-600 cursor-not-allowed border-gray-400":"bg-brand-red-600 hover:bg-brand-red-700 text-white border-brand-red-600"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{className:l==="ar"?"font-arabic":"",children:l==="ar"?"جاري التحقق...":"Checking..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-5 h-5"}),e.jsx("span",{className:l==="ar"?"font-arabic":"",children:l==="ar"?"ترقية الاشتراك":"Upgrade Subscription"})]})})]})]})]})})},mr=()=>{const{language:o,t:i}=L();return e.jsx("div",{className:`max-w-2xl mx-auto text-center ${o==="ar"?"rtl":"ltr"}`,children:e.jsxs(re,{className:"p-8 bg-luxury-ivory border-luxury-gold",children:[e.jsx(st,{className:"h-16 w-16 mx-auto mb-6 text-luxury-gold"}),e.jsx("h2",{className:`text-2xl font-bold text-luxury-black mb-4 ${o==="ar"?"font-arabic":"font-serif"}`,children:i("sell.success.title")}),e.jsx("p",{className:`text-luxury-black/80 mb-6 leading-relaxed ${o==="ar"?"font-arabic":""}`,children:i("sell.success.message")}),e.jsxs("div",{className:`bg-luxury-white p-4 rounded-lg mb-6 ${o==="ar"?"text-right":"text-left"}`,children:[e.jsx("h3",{className:`font-semibold text-luxury-black mb-2 ${o==="ar"?"font-arabic":""}`,children:i("sell.success.next-steps")}),e.jsxs("ul",{className:`space-y-1 text-sm text-luxury-black/80 ${o==="ar"?"font-arabic":""}`,children:[e.jsxs("li",{children:["• ",i("sell.success.step1")]}),e.jsxs("li",{children:["• ",i("sell.success.step2")]}),e.jsxs("li",{children:["• ",i("sell.success.step3")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(A,{onClick:()=>k.visit("/profile"),className:"bg-luxury-black text-luxury-white hover:bg-luxury-gold hover:text-luxury-black",children:[e.jsx(Nt,{className:`h-4 w-4 ${o==="ar"?"ml-2":"mr-2"}`}),e.jsx("span",{className:o==="ar"?"font-arabic":"",children:i("sell.success.view-listings")})]}),e.jsxs(A,{variant:"outline",onClick:()=>{localStorage.removeItem("sell-draft"),k.visit("/sell/category")},className:"border-luxury-black text-luxury-black hover:bg-luxury-black hover:text-luxury-white",children:[e.jsx(St,{className:`h-4 w-4 ${o==="ar"?"ml-2":"mr-2"}`}),e.jsx("span",{className:o==="ar"?"font-arabic":"",children:i("sell.success.create-another")})]})]})]})})},I=[{id:1,path:"category",titleKey:"sell.step1.title"},{id:2,path:"details",titleKey:"sell.step2.title"},{id:3,path:"subscription",titleKey:"sell.step3.title"},{id:4,path:"submitted",titleKey:"sell.step4.title"}],fr=({step:o="category"})=>{const{language:i,t}=L(),{isAuthenticated:r,user:u}=at(),{toast:f}=pt(),[b,l]=m.useState(!1),[y,h]=m.useState(!1),[v,_]=m.useState(null),[j,N]=m.useState(""),[n,a]=m.useState(!1),[c,w]=m.useState(()=>localStorage.getItem("sell-upgrade-mode")==="true"),[s,D]=m.useState(()=>{const d=localStorage.getItem("sell-draft");return d?JSON.parse(d):{}}),[F,hr]=m.useState(s.draftAdId||null),[U,Oe]=m.useState(null),[X,oe]=m.useState(!1),$=I.find(d=>d.path===o)?.id||1;m.useEffect(()=>{r?Be():l(!0)},[r]),m.useEffect(()=>{Object.keys(s).length>0&&localStorage.setItem("sell-draft",JSON.stringify(s))},[s]);const G=d=>{console.log("SellWizard: updateFormData called with newData:",d),D(p=>{const x={...p,...d};return console.log("SellWizard: updated formData:",x),x})},Be=async()=>{if(r)try{const d=localStorage.getItem("authToken");if(!d)return;const p=await fetch("/api/user/subscription",{headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(p.ok){const x=await p.json();x.success&&Oe(x.data)}}catch(d){console.error("Error fetching user subscription:",d)}},ze=async d=>{if(F)try{const p=localStorage.getItem("authToken");if(!p)return;(await fetch(`/api/user/ads/${F}/current-step`,{method:"PATCH",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({current_step:d})})).ok||console.error("Failed to update current step")}catch(p){console.error("Error updating current step:",p)}},O=async()=>{try{console.log("Checking upgrade eligibility"),a(!0);const d=localStorage.getItem("authToken");if(!d)return;const x=await(await fetch("/api/user/subscription-plans/upgrade-eligibility",{headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}})).json();x.success?(_(x.eligible),x.eligible||N(x.message),h(!0)):(_(!1),N(x.message||"Failed to check upgrade eligibility"),h(!0))}catch(d){console.error("Error checking upgrade eligibility:",d),_(!1),N("Failed to check upgrade eligibility"),h(!0)}finally{a(!1)}},Ge=async()=>{if($===2){oe(!0);try{console.log("User subscription:",U);const d=U?.is_active&&new Date(U.expires_at)>new Date,p=(U?.usable_ad_for_this_month??0)>0;if(d&&p){console.log("User has active subscription, creating active ad..."),await ne(),k.visit("/sell/submitted");return}else if(d&&!p){await O();return}else{k.visit("/sell/subscription");return}}finally{oe(!1)}}if($<I.length){const d=$+1;await ze(d);const p=I.find(x=>x.id===d);p&&k.visit(`/sell/${p.path}`)}},ne=async()=>{try{const d=localStorage.getItem("authToken");if(!d){console.error("No auth token found");return}const p=new FormData;s.category_id&&p.append("category_id",s.category_id.toString()),s.title_en&&p.append("title_en",s.title_en),s.title_ar&&p.append("title_ar",s.title_ar),s.description_en&&p.append("description_en",s.description_en),s.description_ar&&p.append("description_ar",s.description_ar),s.product_details_en&&p.append("product_details_en",s.product_details_en),s.product_details_ar&&p.append("product_details_ar",s.product_details_ar),s.condition_id&&p.append("condition_id",s.condition_id.toString()),s.governorate_id&&p.append("governorate_id",s.governorate_id.toString()),s.price&&p.append("price",s.price),s.price_type_id&&p.append("price_type_id",s.price_type_id.toString()),s.is_negotiable!==void 0&&p.append("is_negotiable",s.is_negotiable?"1":"0"),s.subscription_plan_id!==void 0&&p.append("subscription_plan_id",s.subscription_plan_id.toString()),s.images&&s.images.forEach((g,C)=>{if(g instanceof File)p.append(`images[${C}]`,g);else if(typeof g=="string")if(g.startsWith("data:image/"))try{const P=atob(g.split(",")[1]),E=g.split(",")[0].split(":")[1].split(";")[0],B=new ArrayBuffer(P.length),K=new Uint8Array(B);for(let T=0;T<P.length;T++)K[T]=P.charCodeAt(T);const Y=new Blob([B],{type:E}),J=new File([Y],`image_${C}.jpg`,{type:E});p.append(`images[${C}]`,J)}catch(P){console.error("Error converting base64 image:",P)}else g.startsWith("http")&&console.log("Skipping URL image:",g)}),p.append("status","active");const x=await fetch("/api/user/ads",{method:"POST",headers:{Authorization:`Bearer ${d}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:p});if(x.status===403){console.log("Received 403 Forbidden response");try{const g=await x.json();if(console.log("403 response data:",g),g.error_code==="MONTHLY_LIMIT_EXCEEDED"){console.log("Monthly limit exceeded, checking upgrade eligibility"),await O();return}else if(g.error_code==="NO_SUBSCRIPTION"){console.log("No subscription, redirecting to subscription selection"),k.visit("/sell/subscription");return}}catch(g){console.error("Error parsing 403 response:",g)}console.log("403 fallback: checking upgrade eligibility"),await O();return}const S=await x.json();if(S.success)return console.log("Ad created successfully:",S.data.ad),localStorage.removeItem("sell-draft"),S.data.ad.id;if(S.error_code==="NO_SUBSCRIPTION"){k.visit("/sell/subscription");return}else if(S.error_code==="MONTHLY_LIMIT_EXCEEDED"){await O();return}else if(S.errors){const g=Object.values(S.errors).flat();throw console.log("Validation errors:",g),f({title:i==="ar"?"خطأ في التحقق":"Validation Error",description:g.join(", "),variant:"destructive"}),new Error(g.join(", "))}else throw console.log("General error:",S.message),f({title:i==="ar"?"خطأ":"Error",description:S.message||(i==="ar"?"فشل في إنشاء الإعلان":"Failed to create ad"),variant:"destructive"}),new Error(S.message)}catch(d){throw console.error("Error creating ad:",d),f({title:i==="ar"?"خطأ":"Error",description:i==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"}),d}},Ke=()=>{$>1?($===3&&c&&le(),k.visit(`/sell/${I[$-2].path}`)):k.visit("/")},He=async()=>{try{console.log("SellWizard: handleSubmit called with formData:",s),console.log("SellWizard: subscription_plan_id:",s.subscription_plan_id);const d=localStorage.getItem("authToken");if(!d){console.error("No auth token found");return}if(c&&s.subscription_plan_id){await Je();return}const p=await ne();if(!p)return;if(s.subscription_plan_id){const S=await(await fetch(`/api/user/ads/${p}`,{method:"PUT",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({subscription_plan_id:s.subscription_plan_id})})).json();if(!S.success){f({title:i==="ar"?"خطأ":"Error",description:S.message||(i==="ar"?"فشل في تعيين خطة الاشتراك":"Failed to assign subscription plan"),variant:"destructive"});return}}localStorage.removeItem("sell-draft"),k.visit("/sell/submitted")}catch(d){console.error("Error submitting ad:",d),f({title:i==="ar"?"خطأ":"Error",description:i==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"})}},Ve=()=>{const d=(()=>{switch($){case 1:return!!s.category_id;case 2:return!!(s.title_en&&s.title_ar&&s.description_en&&s.description_ar&&s.condition_id&&s.governorate_id&&s.price&&s.price_type_id&&s.images&&s.images.length>0);case 3:return console.log("SellWizard: canContinue check for step 3, subscription_plan_id:",s.subscription_plan_id),!!s.subscription_plan_id;default:return!1}})();return console.log("SellWizard: canContinue check:",{currentStep:$,formData:s,result:d}),d},We=()=>{switch($){case 1:return e.jsx(lr,{formData:s,updateFormData:G});case 2:return e.jsx(vt,{formData:s,updateFormData:G,isSubmitting:X});case 3:return c?e.jsx(ur,{formData:s,updateFormData:G,currentSubscription:U}):e.jsx(dr,{formData:s,updateFormData:G});case 4:return e.jsx(mr,{});default:return null}},ce=I[$-1],qe=()=>{l(!1)},Xe=async()=>{if(v===null){await O();return}v===!0&&(h(!1),w(!0),localStorage.setItem("sell-upgrade-mode","true"),k.visit("/sell/subscription"))},Ye=()=>{h(!1),w(!1),localStorage.removeItem("sell-upgrade-mode"),k.visit("/")},le=()=>{w(!1),localStorage.removeItem("sell-upgrade-mode")},Je=async()=>{try{const d=localStorage.getItem("authToken");if(!d){console.error("No auth token found");return}const x=await(await fetch("/api/user/subscription/upgrade",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({subscription_plan_id:s.subscription_plan_id})})).json();x.success?(f({title:i==="ar"?"تم الترقية بنجاح":"Upgrade Successful",description:i==="ar"?`تمت ترقية اشتراكك! حصلت على ${x.data.ad_limit_increase} إعلان إضافي`:`Your subscription has been upgraded! You received ${x.data.ad_limit_increase} extra ads`,variant:"default"}),le(),await Ze("active")):f({title:i==="ar"?"خطأ في الترقية":"Upgrade Error",description:x.message||(i==="ar"?"فشل في ترقية الاشتراك":"Failed to upgrade subscription"),variant:"destructive"})}catch(d){console.error("Error upgrading subscription:",d),f({title:i==="ar"?"خطأ":"Error",description:i==="ar"?"حدث خطأ غير متوقع":"An unexpected error occurred",variant:"destructive"})}},Ze=async d=>{try{const p=localStorage.getItem("authToken");if(!p){console.error("No auth token found");return}let x,S;if(s.draftAdId)x=await fetch(`/api/user/ads/${s.draftAdId}`,{method:"PUT",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({status:d})}),S=await x.json();else{const g=new FormData;s.category_id&&g.append("category_id",s.category_id.toString()),s.title_en&&g.append("title_en",s.title_en),s.title_ar&&g.append("title_ar",s.title_ar),s.description_en&&g.append("description_en",s.description_en),s.description_ar&&g.append("description_ar",s.description_ar),s.product_details_en&&g.append("product_details_en",s.product_details_en),s.product_details_ar&&g.append("product_details_ar",s.product_details_ar),s.condition_id&&g.append("condition_id",s.condition_id.toString()),s.governorate_id&&g.append("governorate_id",s.governorate_id.toString()),s.price&&g.append("price",s.price),s.price_type_id&&g.append("price_type_id",s.price_type_id.toString()),s.is_negotiable!==void 0&&g.append("is_negotiable",s.is_negotiable?"1":"0"),s.images&&s.images.forEach((C,P)=>{if(C instanceof File)g.append(`images[${P}]`,C);else if(typeof C=="string")if(C.startsWith("data:image/"))try{const E=atob(C.split(",")[1]),B=C.split(",")[0].split(":")[1].split(";")[0],K=new ArrayBuffer(E.length),Y=new Uint8Array(K);for(let H=0;H<E.length;H++)Y[H]=E.charCodeAt(H);const J=new Blob([K],{type:B}),T=new File([J],`image_${P}.jpg`,{type:B});g.append(`images[${P}]`,T)}catch(E){console.error("Error converting base64 image:",E)}else C.startsWith("http")&&console.log("Skipping URL image:",C)}),g.append("status",d),x=await fetch("/api/user/ads",{method:"POST",headers:{Authorization:`Bearer ${p}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:g}),S=await x.json()}if(S.success)localStorage.removeItem("sell-draft"),k.visit("/sell/submitted");else if(S.errors){const g=Object.values(S.errors).flat();f({title:i==="ar"?"خطأ في التحقق":"Validation Error",description:g.join(", "),variant:"destructive"})}else f({title:i==="ar"?"خطأ":"Error",description:S.message||(i==="ar"?"فشل في إرسال الإعلان":"Failed to submit ad"),variant:"destructive"})}catch(p){console.error("Error submitting ad:",p),f({title:i==="ar"?"خطأ":"Error",description:i==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"})}};return r?e.jsx(wt,{children:e.jsxs("div",{className:`max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${i==="ar"?"rtl":"ltr"}`,children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:`text-2xl font-bold text-luxury-black ${i==="ar"?"font-arabic":"font-serif"}`,children:t("sell.wizard.title")}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t("sell.wizard.step")," ",$," ",t("sell.wizard.of")," ",I.length]})]}),e.jsx(Ne,{value:$/I.length*100,className:"mb-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-xl font-semibold text-luxury-black mb-2 ${i==="ar"?"font-arabic":""}`,children:t(ce.titleKey)}),e.jsx("p",{className:`text-muted-foreground ${i==="ar"?"font-arabic":""}`,children:t(`${ce.titleKey}.subtitle`)})]})]}),e.jsx("div",{className:"mb-8",children:We()}),$<4&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-border",children:[e.jsxs(A,{variant:"secondary",onClick:Ke,className:"flex items-center gap-2",children:[e.jsx(ft,{className:`h-4 w-4 ${i==="ar"?"rotate-180":""}`}),e.jsx("span",{className:i==="ar"?"font-arabic":"",children:t("sell.wizard.back")})]}),e.jsx(A,{onClick:$===3?He:Ge,disabled:!Ve()||X,className:"flex items-center gap-2",children:X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{className:i==="ar"?"font-arabic":"",children:i==="ar"?"جاري المعالجة...":"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:i==="ar"?"font-arabic":"",children:t($===3?"sell.wizard.submit":"sell.wizard.continue")}),e.jsx(kt,{className:`h-4 w-4 ${i==="ar"?"rotate-180":""}`})]})})]}),e.jsx(pr,{isOpen:y,onClose:()=>h(!1),onUpgrade:Xe,onGoHome:Ye,upgradeEligible:v,upgradeError:j,checkingEligibility:n})]})}):e.jsx(mt,{isOpen:b,onClose:()=>{l(!1),k.visit("/")},onSuccess:qe})};function Xr({step:o="category"}){return m.useEffect(()=>{(o==="sell"||o==="")&&k.visit("/sell/category",{replace:!0})},[o]),m.useEffect(()=>{if(o==="category"){const i=localStorage.getItem("sell-draft");if(i){const t=JSON.parse(i);if(t.draftAdId){const r=t.current_step||2,f={1:"category",2:"details",3:"subscription",4:"submitted"}[r]||"details";f!=="category"&&k.visit(`/sell/${f}`,{replace:!0})}}}},[o]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(dt,{}),e.jsx("main",{className:"py-16",children:e.jsx(fr,{step:o})}),e.jsx(ut,{})]})}export{Xr as default};
