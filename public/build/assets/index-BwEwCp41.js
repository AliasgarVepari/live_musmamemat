import{r as S,j as e,H as E,L as K,a as w}from"./app-CiN-z-mi.js";import{B as m}from"./badge-BeEVwe-7.js";import{B as _}from"./button-CwwqYzBh.js";import{C,a as Q,b as Y,d as Z,c as k}from"./card-C9ipyH0f.js";import{I as ee}from"./input-BtLlCDAq.js";import{S as u,a as h,b as p,c as j,d as r}from"./select-AqtfVAY5.js";import{U as A,a as D,S as se,b as te,c as ae}from"./suspension-dialog-BMyW5arF.js";import{u as re}from"./use-cached-pagination-Dr_igKYz.js";import{u as ie}from"./use-error-handler-CAQAgIfQ.js";import{A as $,U as ne}from"./app-layout-DTXGJZxa.js";import{F as le}from"./filter-BIBEuQGj.js";import{S as ce}from"./search-B2lordE5.js";import{U as oe}from"./user-DWfJnslh.js";import{E as de}from"./eye-CG5B-DUa.js";import{T as L}from"./trash-2-7epWCtSP.js";import{S as me}from"./shield-DyN8pLk1.js";import"./index-Nuw4A2-P.js";import"./index-CoqcMh53.js";import"./index-BdQq_4o_.js";import"./index-DtnZEJZD.js";import"./index-v4sJvo-e.js";import"./check-DP3vZQ8y.js";import"./dialog-CFbaL1bR.js";import"./textarea-DIzCOTHS.js";import"./label-C6w6hgJn.js";import"./index-CiC8GUB_.js";import"./useQuery-1tLj2zkj.js";import"./chevron-right-BYcuDYwb.js";import"./index-CDOJiyEw.js";import"./index-DW9AIAM8.js";import"./base-layout-DZyBKCCS.js";/* empty css            */import"./use-forced-theme-CWthfpdt.js";import"./settings-DUw5aPq3.js";import"./logo-DB6pQEXk.js";import"./map-pin-W1PPpquu.js";import"./crown-CQOnRZo_.js";const P=[{title:"Users",href:"/admin/users"}];function Je({users:U,governorates:B,filters:d}){const[I,g]=S.useState(!1),[f,M]=S.useState(null),[F,v]=S.useState(!1);ie();const{data:T,isLoading:V,paginationState:l,goToPage:N,setPerPage:H,setSearch:O,updateFilter:b,refetch:y}=re({endpoint:"/admin/users",initialPage:U.current_page,initialPerPage:d.per_page||"20",initialSearch:d.search||"",initialFilters:{subscription_status:d.subscription_status||"all",status:d.status||"all",governorate_id:d.governorate_id||"all"}}),a=T||U;if(V&&!a)return e.jsxs($,{breadcrumbs:P,children:[e.jsx(E,{title:"Users Management"}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 overflow-x-auto rounded-xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})})]});const z=s=>{s.status==="active"?(M(s),g(!0)):w.patch(`/admin/users/${s.id}/toggle`,{},{onSuccess:()=>{y()},onError:t=>{const n=Object.values(t).flat().join(", ");alert(`Error: ${n}`)}})},R=s=>{f&&(v(!0),w.patch(`/admin/users/${f.id}/suspend`,{suspension_reason:s},{onSuccess:()=>{v(!1),g(!1),M(null),y()},onError:t=>{v(!1);const n=Object.values(t).flat().join(", ");alert(`Error: ${n}`)}}))},W=s=>{const t=prompt("Please provide a reason for deleting this user account:");t&&t.trim()&&w.delete(`/admin/users/${s}`,{data:{deletion_reason:t},onSuccess:()=>{y()},onError:i=>{const c=Object.values(i).flat().join(", ");alert(`Error: ${c}`)}})},X=s=>{const t={active:{variant:"default",icon:D,text:"Active"},suspended:{variant:"secondary",icon:A,text:"Suspended"},deleted:{variant:"outline",icon:L,text:"Deleted"}},i=t[s]||t.active,n=i.icon;return e.jsxs(m,{variant:i.variant,className:"flex items-center gap-1",children:[e.jsx(n,{className:"h-3 w-3"}),i.text]})},G=s=>{if(!s.subscription)return e.jsx(m,{variant:"outline",children:"No Subscription"});const t=new Date(s.subscription.expires_at)<new Date;return s.subscription.is_active&&!t?e.jsxs(m,{variant:"default",className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),s.subscription.plan.name]}):t?e.jsxs(m,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),"Expired"]}):e.jsxs(m,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),"Inactive"]})};return e.jsxs($,{breadcrumbs:P,children:[e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"Users Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Users Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, subscriptions, and permissions"})]})}),e.jsxs(C,{children:[e.jsxs(Q,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Filters"]}),e.jsx(Z,{children:"Search and filter users by various criteria"})]}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"text-muted-foreground absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2"}),e.jsx(ee,{placeholder:"Search users...",value:l.search,onChange:s=>O(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Subscription"}),e.jsxs(u,{value:l.filters.subscription_status,onValueChange:s=>b("subscription_status",s),children:[e.jsx(h,{children:e.jsx(p,{placeholder:"All subscriptions"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All subscriptions"}),e.jsx(r,{value:"subscribed",children:"Subscribed"}),e.jsx(r,{value:"expired",children:"Expired"}),e.jsx(r,{value:"unsubscribed",children:"Unsubscribed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(u,{value:l.filters.status,onValueChange:s=>b("status",s),children:[e.jsx(h,{children:e.jsx(p,{placeholder:"All statuses"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All statuses"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"suspended",children:"Suspended"}),e.jsx(r,{value:"deleted",children:"Deleted"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Governorate"}),e.jsxs(u,{value:l.filters.governorate_id,onValueChange:s=>b("governorate_id",s),children:[e.jsx(h,{children:e.jsx(p,{placeholder:"All governorates"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All governorates"}),B.map(s=>e.jsx(r,{value:s.id.toString(),children:s.name_en},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Records per page"}),e.jsxs(u,{value:l.perPage,onValueChange:H,children:[e.jsx(h,{children:e.jsx(p,{placeholder:"Records per page"})}),e.jsxs(j,{children:[e.jsx(r,{value:"5",children:"5"}),e.jsx(r,{value:"10",children:"10"}),e.jsx(r,{value:"20",children:"20"}),e.jsx(r,{value:"50",children:"50"}),e.jsx(r,{value:"100",children:"100"})]})]})]})]})})]}),e.jsx("div",{className:"grid gap-4",children:a?.data?.map(s=>e.jsx(C,{className:"transition-shadow hover:shadow-md",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-primary/10 flex h-12 w-12 items-center justify-center rounded-full",children:e.jsx(oe,{className:"text-primary h-6 w-6"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name_en}),X(s.status),G(s)]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.email}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.phone}),s.governorate&&e.jsx("p",{className:"text-muted-foreground text-sm",children:s.governorate.name_en})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-muted-foreground text-right text-sm",children:[e.jsxs("div",{children:[s.ads_count," ads"]}),e.jsxs("div",{children:[s.ad_views_count," views"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(K,{href:`/admin/users/${s.id}`,children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>z(s),children:s.status==="active"?e.jsx(A,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"})}),e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>W(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(L,{className:"h-4 w-4"})})]})]})]})})},s.id))}),a?.data?.length===0&&e.jsx(C,{children:e.jsxs(k,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(ne,{className:"mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"text-center text-gray-500",children:l.search||l.filters.subscription_status!=="all"||l.filters.status!=="all"||l.filters.governorate_id!=="all"?"No users match your current filters.":"No users have registered yet. Users will appear here once they sign up."})]})}),a?.data&&a.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs("div",{className:"text-base font-medium text-gray-700",children:[a.from," - ",a.to," of ",a.total," users"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>N(a.current_page-1),disabled:a.current_page<=1,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${a.current_page>1?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const s=a.current_page,t=a.last_page,i=2,n=[],c=[];for(let o=Math.max(2,s-i);o<=Math.min(t-1,s+i);o++)n.push(o);return s-i>2?c.push(1,"..."):c.push(1),c.push(...n),t>1&&(s+i<t-1?c.push("...",t):n.includes(t)||c.push(t)),c.map((o,q)=>{if(o==="...")return e.jsx("span",{className:"text-muted-foreground px-2",children:"..."},`dots-${q}`);const x=o,J=x===s;return e.jsx("button",{onClick:()=>N(x),className:`flex h-10 w-10 items-center justify-center rounded-full text-base font-medium transition-colors ${J?"bg-black text-white":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"}`,children:x},x)})})()}),e.jsx("button",{onClick:()=>N(a.current_page+1),disabled:a.current_page>=a.last_page,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${a.current_page<a.last_page?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})]})]}),e.jsx(se,{open:I,onOpenChange:g,onConfirm:R,userName:f?.name_en||"",isSuspending:F})]})}export{Je as default};
