import{n as j,o as S,r,j as t,H as w}from"./app-CYWBXX07.js";import{U as O}from"./user-layout-CwyDyt83.js";import{I as c,B as d}from"./input-BsgEeQev.js";import"./use-forced-theme-HDN5vuZO.js";/* empty css            */import"./index-DK5vjGzq.js";function b({provider_user_id:p}){const{addToast:i}=j(),{setServerAuth:h}=S(),[a,u]=r.useState(""),[l,m]=r.useState(""),[f,g]=r.useState("phone"),[o,n]=r.useState(!1),y=async()=>{try{n(!0);const e=await fetch("/api/user/auth/phone/send-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:a,provider_user_id:p})}),s=await e.json();if(!e.ok||!s.success)throw new Error(s.message||"Failed");g("otp"),i({type:"info",title:"OTP Sent",message:"Enter the 6-digit code."})}catch(e){i({type:"error",title:"Error",message:e.message||"Failed to send OTP"})}finally{n(!1)}},x=async()=>{try{n(!0);const e=await fetch("/api/user/auth/phone/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:a,otp:l})}),s=await e.json();if(!e.ok||!s.success)throw new Error(s.message||"Failed");h(s.data.user,!0),localStorage.setItem("authUser",JSON.stringify(s.data.user)),localStorage.setItem("authToken",s.data.token),window.location.href="/profile"}catch(e){i({type:"error",title:"Error",message:e.message||"Failed to verify OTP"})}finally{n(!1)}};return t.jsxs(O,{children:[t.jsx(w,{title:"Complete Phone"}),t.jsxs("div",{className:"mx-auto w-full max-w-md p-4",children:[t.jsx("h1",{className:"mb-4 text-xl font-semibold",children:"Complete your phone"}),f==="phone"?t.jsxs("div",{className:"space-y-3",children:[t.jsx(c,{placeholder:"Phone (8 digits)",value:a,onChange:e=>u(e.target.value)}),t.jsx(d,{onClick:y,disabled:o||a.length!==8,className:"w-full",children:o?"Sending…":"Send OTP"})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx(c,{placeholder:"Enter OTP",value:l,onChange:e=>m(e.target.value)}),t.jsx(d,{onClick:x,disabled:o||l.length!==6,className:"w-full",children:o?"Verifying…":"Verify"})]})]})]})}export{b as default};
