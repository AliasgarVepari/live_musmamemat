import{m as p,r}from"./app-uIBbFV7s.js";const F=()=>{const{isAuthenticated:s}=p(),[u,n]=r.useState(new Set),[h,o]=r.useState(!1),[v,i]=r.useState(null);r.useEffect(()=>{s?g():n(new Set)},[s]);const g=async()=>{try{o(!0);const e=await fetch("/api/user/favorites",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json(),l=new Set(t.data.data?.map(a=>a.ad?.id).filter(Boolean)||[]);n(l)}}catch(e){console.error("Error loading favorites:",e),i("Failed to load favorites")}finally{o(!1)}},d=e=>u.has(e);return{favorites:u,isFavorited:d,toggleFavorite:async e=>{if(!s)throw new Error("Authentication required");try{o(!0),i(null);const t=d(e),l=t?"DELETE":"POST",a=await fetch(`/api/user/products/${e}/favorite`,{method:l,headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(a.ok)n(c=>{const f=new Set(c);return t?f.delete(e):f.add(e),f});else{const c=await a.json();throw new Error(c.message||"Failed to update favorite")}}catch(t){throw console.error("Error toggling favorite:",t),i(t instanceof Error?t.message:"Failed to update favorite"),t}finally{o(!1)}},loading:h,error:v}};export{F as u};
