import{j as e,H as _,L as z,a as S}from"./app-CGryBRXP.js";import{B as x}from"./badge-D1NyOr1w.js";import{B as v}from"./button-SNj-nWIH.js";import{C as N,a as R,b as W,d as O,c as b}from"./card-B4aMH3hL.js";import{I as X}from"./input-C63PEyT1.js";import{S as h,a as u,b as p,c as j,d as r}from"./select-DB0QV4A_.js";import{u as G}from"./use-cached-pagination-BvQVU0nP.js";import{u as q}from"./use-error-handler-G9EZqZdJ.js";import{A as C,U as J}from"./app-layout-BfBZgUJI.js";import{F as K}from"./filter-C4hkLD6e.js";import{S as Q}from"./search-CZ5XVuN1.js";import{U as Y}from"./user-CtrtCV8v.js";import{E as Z}from"./eye-Cat1DFEL.js";import{U as k,a as U,S as ee,b as se}from"./user-x-CmR4LZRx.js";import{T as M}from"./trash-2-RgY1TXCH.js";import{S as te}from"./shield--0xB7Eu7.js";import"./index-CkMd_aJy.js";import"./index-qdsz5cHj.js";import"./index-BdQq_4o_.js";import"./index-CXjHsVTM.js";import"./index-CRQF9sb8.js";import"./check-IZ7Z6T5i.js";import"./useQuery-Csg-kStS.js";import"./chevron-right-D8snHXB_.js";import"./index-B5axZl32.js";import"./index-DW9AIAM8.js";import"./base-layout-BCguWz8i.js";/* empty css            */import"./use-forced-theme-DwRRO29i.js";import"./settings-Bok75KGb.js";import"./logo-DB6pQEXk.js";import"./map-pin-CMEq9zr5.js";import"./crown-z-HgkuGJ.js";const A=[{title:"Users",href:"/admin/users"}];function De({users:y,governorates:E,filters:d}){q();const{data:L,isLoading:P,paginationState:l,goToPage:g,setPerPage:$,setSearch:B,updateFilter:f,refetch:w}=G({endpoint:"/admin/users",initialPage:y.current_page,initialPerPage:d.per_page||"20",initialSearch:d.search||"",initialFilters:{subscription_status:d.subscription_status||"all",status:d.status||"all",governorate_id:d.governorate_id||"all"}}),t=L||y;if(P&&!t)return e.jsxs(C,{breadcrumbs:A,children:[e.jsx(_,{title:"Users Management"}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 overflow-x-auto rounded-xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading users..."})]})})]});const D=s=>{S.patch(`/admin/users/${s}/toggle`,{},{onSuccess:()=>{w()},onError:a=>{const n=Object.values(a).flat().join(", ");alert(`Error: ${n}`)}})},F=s=>{const a=prompt("Please provide a reason for deleting this user account:");a&&a.trim()&&S.delete(`/admin/users/${s}`,{data:{deletion_reason:a},onSuccess:()=>{w()},onError:i=>{const c=Object.values(i).flat().join(", ");alert(`Error: ${c}`)}})},I=s=>{const a={active:{variant:"default",icon:U,text:"Active"},suspended:{variant:"secondary",icon:k,text:"Suspended"},deleted:{variant:"outline",icon:M,text:"Deleted"}},i=a[s]||a.active,n=i.icon;return e.jsxs(x,{variant:i.variant,className:"flex items-center gap-1",children:[e.jsx(n,{className:"h-3 w-3"}),i.text]})},T=s=>{if(!s.subscription)return e.jsx(x,{variant:"outline",children:"No Subscription"});const a=new Date(s.subscription.expires_at)<new Date;return s.subscription.is_active&&!a?e.jsxs(x,{variant:"default",className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),s.subscription.plan.name]}):a?e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),"Expired"]}):e.jsxs(x,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),"Inactive"]})};return e.jsx(C,{breadcrumbs:A,children:e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Users Management"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Users Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage user accounts, subscriptions, and permissions"})]})}),e.jsxs(N,{children:[e.jsxs(R,{children:[e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Filters"]}),e.jsx(O,{children:"Search and filter users by various criteria"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"text-muted-foreground absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2"}),e.jsx(X,{placeholder:"Search users...",value:l.search,onChange:s=>B(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Subscription"}),e.jsxs(h,{value:l.filters.subscription_status,onValueChange:s=>f("subscription_status",s),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"All subscriptions"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All subscriptions"}),e.jsx(r,{value:"subscribed",children:"Subscribed"}),e.jsx(r,{value:"expired",children:"Expired"}),e.jsx(r,{value:"unsubscribed",children:"Unsubscribed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(h,{value:l.filters.status,onValueChange:s=>f("status",s),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"All statuses"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All statuses"}),e.jsx(r,{value:"active",children:"Active"}),e.jsx(r,{value:"suspended",children:"Suspended"}),e.jsx(r,{value:"deleted",children:"Deleted"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Governorate"}),e.jsxs(h,{value:l.filters.governorate_id,onValueChange:s=>f("governorate_id",s),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"All governorates"})}),e.jsxs(j,{children:[e.jsx(r,{value:"all",children:"All governorates"}),E.map(s=>e.jsx(r,{value:s.id.toString(),children:s.name_en},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Records per page"}),e.jsxs(h,{value:l.perPage,onValueChange:$,children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Records per page"})}),e.jsxs(j,{children:[e.jsx(r,{value:"5",children:"5"}),e.jsx(r,{value:"10",children:"10"}),e.jsx(r,{value:"20",children:"20"}),e.jsx(r,{value:"50",children:"50"}),e.jsx(r,{value:"100",children:"100"})]})]})]})]})})]}),e.jsx("div",{className:"grid gap-4",children:t?.data?.map(s=>e.jsx(N,{className:"transition-shadow hover:shadow-md",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-primary/10 flex h-12 w-12 items-center justify-center rounded-full",children:e.jsx(Y,{className:"text-primary h-6 w-6"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name_en}),I(s.status),T(s)]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.email}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.phone}),s.governorate&&e.jsx("p",{className:"text-muted-foreground text-sm",children:s.governorate.name_en})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"text-muted-foreground text-right text-sm",children:[e.jsxs("div",{children:[s.ads_count," ads"]}),e.jsxs("div",{children:[s.ad_views_count," views"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(z,{href:`/admin/users/${s.id}`,children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>D(s.id),children:s.status==="active"?e.jsx(k,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>F(s.id),className:"text-destructive hover:text-destructive",children:e.jsx(M,{className:"h-4 w-4"})})]})]})]})})},s.id))}),t?.data?.length===0&&e.jsx(N,{children:e.jsxs(b,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(J,{className:"mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"text-center text-gray-500",children:l.search||l.filters.subscription_status!=="all"||l.filters.status!=="all"||l.filters.governorate_id!=="all"?"No users match your current filters.":"No users have registered yet. Users will appear here once they sign up."})]})}),t?.data&&t.data.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs("div",{className:"text-base font-medium text-gray-700",children:[t.from," - ",t.to," of ",t.total," users"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>g(t.current_page-1),disabled:t.current_page<=1,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${t.current_page>1?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const s=t.current_page,a=t.last_page,i=2,n=[],c=[];for(let o=Math.max(2,s-i);o<=Math.min(a-1,s+i);o++)n.push(o);return s-i>2?c.push(1,"..."):c.push(1),c.push(...n),a>1&&(s+i<a-1?c.push("...",a):n.includes(a)||c.push(a)),c.map((o,V)=>{if(o==="...")return e.jsx("span",{className:"text-muted-foreground px-2",children:"..."},`dots-${V}`);const m=o,H=m===s;return e.jsx("button",{onClick:()=>g(m),className:`flex h-10 w-10 items-center justify-center rounded-full text-base font-medium transition-colors ${H?"bg-black text-white":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"}`,children:m},m)})})()}),e.jsx("button",{onClick:()=>g(t.current_page+1),disabled:t.current_page>=t.last_page,className:`flex h-10 w-10 items-center justify-center rounded-full transition-colors ${t.current_page<t.last_page?"text-gray-600 hover:bg-gray-100 hover:text-gray-900":"cursor-not-allowed text-gray-300"}`,children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})]})]})})}export{De as default};
