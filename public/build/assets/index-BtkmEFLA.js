import{d as W,j as e,H as P,r as $}from"./app-Bky3aKG0.js";import{B as n}from"./badge-DHAUOUIo.js";import{B as g}from"./button-BsOJNgmv.js";import{C as x,c as o,a as A,b as F}from"./card-DOyzQyYu.js";import{I as p}from"./input-C2F9DW4n.js";import{S as N,a as v,b as y,c as _,d as t}from"./select-HclPlDOM.js";import{u as z}from"./use-cached-pagination-s9svt0dS.js";import{u as K}from"./use-error-handler-Cy_WODZV.js";import{A as D,D as q,U as O}from"./app-layout-BlPRz9KN.js";import{C as M}from"./credit-card-DIE3myIt.js";import{T as G}from"./trending-up-DeIo7eT9.js";import{F as J}from"./filter-BlrfYVpK.js";import{S as Q}from"./search-DbkSQsHM.js";import"./index-vqdhYpvm.js";import"./index-BrKjbnJC.js";import"./index-BdQq_4o_.js";import"./index-UaqzrlZK.js";import"./index-B55r3Rxw.js";import"./check-BmkPoAXu.js";import"./useQuery-vI502B-c.js";import"./chevron-right-Bn16hML1.js";import"./index-SdXyOe5m.js";import"./index-DW9AIAM8.js";import"./base-layout-BwXaCZNP.js";/* empty css            */import"./use-forced-theme-D0-cd20T.js";import"./settings-ROQ9z5wm.js";import"./logo-DB6pQEXk.js";import"./map-pin-CL942ZEc.js";import"./crown-Bzu7fpRD.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Y=W("Download",X),R=[{title:"Finance",href:"/admin/finance"}];function Pe({transactions:h,filters:r,stats:u}){K();const{data:L,isLoading:B,paginationState:a,goToPage:b,setPerPage:I,setSearch:w,updateFilter:i}=z({endpoint:"/admin/finance",dataKey:"transactions",initialPage:h.current_page,initialPerPage:r.per_page||"10",initialSearch:r.search||"",initialFilters:{status:r.status||"all",payment_method:r.payment_method||"all",type:r.type||"all",date_from:r.date_from||"",date_to:r.date_to||"",amount_min:r.amount_min||"",amount_max:r.amount_max||""}}),l=L||h;if(B&&!l)return e.jsxs(D,{breadcrumbs:R,children:[e.jsx(P,{title:"Finance Management"}),e.jsx("div",{className:"flex h-full flex-1 flex-col items-center justify-center gap-6 overflow-x-auto rounded-xl p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 animate-spin rounded-full border-b-2 border-gray-900"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading transactions..."})]})})]});$.useEffect(()=>{const s=setTimeout(()=>{w(a.search)},300);return()=>clearTimeout(s)},[a.search,w]);const U=s=>{switch(s){case"completed":return e.jsx(n,{className:"bg-green-100 text-green-800",children:"Completed"});case"pending":return e.jsx(n,{className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"failed":return e.jsx(n,{className:"bg-red-100 text-red-800",children:"Failed"});case"refunded":return e.jsx(n,{className:"bg-orange-100 text-orange-800",children:"Refunded"});default:return e.jsx(n,{variant:"secondary",children:s})}},V=s=>{switch(s){case"subscription":return e.jsx(n,{className:"bg-blue-100 text-blue-800",children:"Subscription"});case"upgrade":return e.jsx(n,{className:"bg-purple-100 text-purple-800",children:"Upgrade"});case"renewal":return e.jsx(n,{className:"bg-green-100 text-green-800",children:"Renewal"});default:return e.jsx(n,{variant:"secondary",children:s})}},C=s=>`${(typeof s=="string"?parseFloat(s):s).toFixed(2)} KWD`,k=s=>s?new Date(s).toLocaleDateString():"N/A",E=()=>{const s=new URLSearchParams;a.search&&a.search.trim()&&s.append("search",a.search),a.filters.status&&a.filters.status!=="all"&&s.append("status",a.filters.status),a.filters.payment_method&&a.filters.payment_method!=="all"&&s.append("payment_method",a.filters.payment_method),a.filters.date_from&&a.filters.date_from.trim()&&s.append("date_from",a.filters.date_from),a.filters.date_to&&a.filters.date_to.trim()&&s.append("date_to",a.filters.date_to),a.filters.amount_min&&a.filters.amount_min.trim()&&s.append("amount_min",a.filters.amount_min),a.filters.amount_max&&a.filters.amount_max.trim()&&s.append("amount_max",a.filters.amount_max),a.perPage&&s.append("per_page",a.perPage),window.open(`/admin/finance/export?${s.toString()}`,"_blank")};return e.jsxs(D,{breadcrumbs:R,children:[e.jsx(P,{title:"Finance"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-auto rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Finance"}),e.jsx("p",{className:"text-gray-600",children:"View and manage all financial transactions"})]}),e.jsxs(g,{onClick:E,children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"rounded-lg bg-green-100 p-2",children:e.jsx(q,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C(u.total_revenue)})]})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"rounded-lg bg-blue-100 p-2",children:e.jsx(M,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.total_transactions})]})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"rounded-lg bg-purple-100 p-2",children:e.jsx(O,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed Transactions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.completed_transactions})]})]})})}),e.jsx(x,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"rounded-lg bg-orange-100 p-2",children:e.jsx(G,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C(u.monthly_revenue)})]})]})})})]}),e.jsxs(x,{children:[e.jsx(A,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Filters"]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 transform text-gray-400"}),e.jsx(p,{placeholder:"Search users...",value:a.search,onChange:s=>w(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(N,{value:a.filters.status,onValueChange:s=>i("status",s),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"All Statuses"})}),e.jsxs(_,{children:[e.jsx(t,{value:"all",children:"All Statuses"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"failed",children:"Failed"}),e.jsx(t,{value:"refunded",children:"Refunded"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Type"}),e.jsxs(N,{value:a.filters.type,onValueChange:s=>i("type",s),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"All Types"})}),e.jsxs(_,{children:[e.jsx(t,{value:"all",children:"All Types"}),e.jsx(t,{value:"subscription",children:"Subscription"}),e.jsx(t,{value:"upgrade",children:"Upgrade"}),e.jsx(t,{value:"renewal",children:"Renewal"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Payment Method"}),e.jsxs(N,{value:a.filters.payment_method,onValueChange:s=>i("payment_method",s),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"All Methods"})}),e.jsxs(_,{children:[e.jsx(t,{value:"all",children:"All Methods"}),e.jsx(t,{value:"credit_card",children:"Credit Card"}),e.jsx(t,{value:"paypal",children:"PayPal"}),e.jsx(t,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(t,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date Range"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"From"}),e.jsx(p,{type:"date",value:a.filters.date_from,onChange:s=>i("date_from",s.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"To"}),e.jsx(p,{type:"date",value:a.filters.date_to,onChange:s=>i("date_to",s.target.value),className:"w-full"})]})]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount Range"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Min Amount"}),e.jsx(p,{type:"number",placeholder:"0.00",value:a.filters.amount_min,onChange:s=>i("amount_min",s.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"Max Amount"}),e.jsx(p,{type:"number",placeholder:"1000.00",value:a.filters.amount_max,onChange:s=>i("amount_max",s.target.value),className:"w-full"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Records per page"}),e.jsxs(N,{value:a.perPage,onValueChange:I,children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Records per page"})}),e.jsxs(_,{children:[e.jsx(t,{value:"5",children:"5"}),e.jsx(t,{value:"10",children:"10"}),e.jsx(t,{value:"20",children:"20"}),e.jsx(t,{value:"50",children:"50"}),e.jsx(t,{value:"100",children:"100"})]})]})]})]})]})]}),e.jsxs(x,{children:[e.jsx(A,{children:e.jsx(F,{children:"Transactions"})}),e.jsxs(o,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Transaction ID"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Payment Method"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Date"})]})}),e.jsx("tbody",{children:l?.data?.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 font-mono text-sm",children:[e.jsxs("div",{className:"font-medium",children:["#",s.id]}),e.jsx("div",{className:"text-xs text-gray-500",children:s.transaction_id})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user.name_en}),e.jsx("div",{className:"text-sm text-gray-500",children:s.user.email})]})}),e.jsx("td",{className:"px-4 py-3",children:V(s.type)}),e.jsx("td",{className:"px-4 py-3",children:s.subscriptionPlan?.name_en||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:U(s.status)}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm",children:s.payment_method||"N/A"}),s.payment_gateway&&e.jsx("div",{className:"text-xs text-gray-500",children:s.payment_gateway})]}),e.jsx("td",{className:"px-4 py-3 font-medium",children:C(s.amount)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-500",children:[e.jsx("div",{children:k(s.created_at)}),s.processed_at&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Processed: ",k(s.processed_at)]})]})]},s.id))})]})}),l?.data?.length===0&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(M,{className:"mx-auto mb-4 h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mb-2 text-lg font-medium text-gray-900",children:"No transactions found"}),e.jsx("p",{className:"text-gray-500",children:a.search||a.filters.status!=="all"||a.filters.payment_method!=="all"||a.filters.type!=="all"||a.filters.date_from||a.filters.date_to||a.filters.amount_min||a.filters.amount_max?"No transactions match your current filters.":"No transactions have been recorded yet."})]})]})]}),l?.last_page&&l.last_page>=1?e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",l.from," - ",l.to," of ",l.total," transactions"]}),e.jsx("div",{className:"flex items-center space-x-2",children:l.last_page>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>b(l.current_page-1),disabled:l.current_page<=1,children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"flex items-center space-x-1",children:(()=>{const s=l.current_page,d=l.last_page,j=2,S=[],c=[];for(let m=Math.max(2,s-j);m<=Math.min(d-1,s+j);m++)S.push(m);return s-j>2?c.push(1,"..."):c.push(1),c.push(...S),d>1&&(s+j<d-1?c.push("...",d):S.includes(d)||c.push(d)),c.map((m,H)=>{if(m==="...")return e.jsx("span",{className:"text-muted-foreground px-2",children:"..."},`dots-${H}`);const f=m,T=f===s;return e.jsx(g,{variant:T?"default":"outline",size:"sm",className:`h-10 w-10 ${T?"bg-black text-white hover:bg-black":""}`,onClick:()=>b(f),children:f},f)})})()}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>b(l.current_page+1),disabled:l.current_page>=l.last_page,children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})]}):e.jsx("div",{className:"flex items-center justify-between px-4",children:e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",h.from," - ",h.to," of ",h.total," transactions"]})})]})]})}export{Pe as default};
