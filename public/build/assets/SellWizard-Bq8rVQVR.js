import{b as E,r as m,j as e,g as J,P as T,c as Z,f as qe,e as Q,h as Y,k as Xe,i as Ye,n as O,T as Je,C as Ze,a as w,m as Qe}from"./app-DTvt3JWn.js";import{L as et,a as tt,B as I,D as rt,d as at,e as st,f as it,H as ot,F as nt,o as ct,A as lt,C as dt}from"./Header-B1MbFeak.js";import{f as de,u as ut,g as pt,I as mt}from"./index-BjlFgQd3.js";import{u as ft}from"./index-DidabVOd.js";import{S as ht}from"./shopping-bag-aET60yhK.js";import{H as ue,Z as gt,S as xt,P as bt}from"./SelectUpgradeSubscription-CjE2vyJ7.js";import{P as yt}from"./package-BfbAv5DA.js";import{C as pe,a as vt}from"./card-BFQJBt-X.js";import{C as _t}from"./check-Ds5LABLY.js";import{S as ne}from"./star-DMc7nQT_.js";import{C as jt}from"./crown-DzPJDLDE.js";import{C as Nt}from"./credit-card-Bp0wqzf3.js";import{E as St}from"./eye-C966aCWl.js";import{P as wt}from"./plus-DBK7DwhH.js";import{U as kt}from"./user-layout-CanBJl6i.js";import{C as Ct}from"./chevron-right-DQYwBuVV.js";import"./useQuery-DDNnmxB5.js";import"./phone-B5JFgEkD.js";import"./index-Bzk_0laE.js";import"./index-aqO7kOVQ.js";import"./index-dv7WKkPX.js";import"./loader-circle-D8daeID1.js";import"./search-uO9waHIl.js";import"./user-C0ZfagPN.js";import"./select-Cparoiej.js";import"./index-_17AcTiR.js";import"./index-BdQq_4o_.js";import"./index-DxKvbSj0.js";import"./upload-C_q7B7IK.js";import"./use-forced-theme-Bw5L6RiE.js";/* empty css            *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M9 12h.01",key:"157uk2"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M19 6.3a9 9 0 0 1 1.8 3.9 2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"5yv0yz"}]],Rt=E("Baby",$t);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],At=E("Circle",Et);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],It=E("Gamepad2",Pt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]],Tt=E("Gem",Mt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],Lt=E("Plane",Dt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z",key:"1wgbhj"}]],Ot=E("Shirt",Ft);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],zt=E("Smartphone",Ut);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Gt=E("Sparkles",Bt);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["polyline",{points:"12 10 12 12 13 13",key:"19dquz"}],["path",{d:"m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05",key:"18k57s"}],["path",{d:"m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05",key:"16ny36"}]],Kt=E("Watch",Ht);var ee="Progress",te=100,[Vt,Wr]=J(ee),[Wt,qt]=Vt(ee),me=m.forwardRef((s,a)=>{const{__scopeProgress:t,value:i=null,max:c,getValueLabel:p=Xt,...x}=s;(c||c===0)&&!ce(c)&&console.error(Yt(`${c}`,"Progress"));const u=ce(c)?c:te;i!==null&&!le(i,u)&&console.error(Jt(`${i}`,"Progress"));const b=le(i,u)?i:null,h=K(b)?p(b,u):void 0;return e.jsx(Wt,{scope:t,value:b,max:u,children:e.jsx(T.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":K(b)?b:void 0,"aria-valuetext":h,role:"progressbar","data-state":ge(b,u),"data-value":b??void 0,"data-max":u,...x,ref:a})})});me.displayName=ee;var fe="ProgressIndicator",he=m.forwardRef((s,a)=>{const{__scopeProgress:t,...i}=s,c=qt(fe,t);return e.jsx(T.div,{"data-state":ge(c.value,c.max),"data-value":c.value??void 0,"data-max":c.max,...i,ref:a})});he.displayName=fe;function Xt(s,a){return`${Math.round(s/a*100)}%`}function ge(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function K(s){return typeof s=="number"}function ce(s){return K(s)&&!isNaN(s)&&s>0}function le(s,a){return K(s)&&!isNaN(s)&&s<=a&&s>=0}function Yt(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${te}\`.`}function Jt(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${te} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var xe=me,Zt=he;const be=m.forwardRef(({className:s,value:a,...t},i)=>e.jsx(xe,{ref:i,className:Z("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...t,children:e.jsx(Zt,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));be.displayName=xe.displayName;var re="Radio",[Qt,ye]=J(re),[er,tr]=Qt(re),ve=m.forwardRef((s,a)=>{const{__scopeRadio:t,name:i,checked:c=!1,required:p,disabled:x,value:u="on",onCheck:b,form:h,...y}=s,[v,N]=m.useState(null),j=Q(a,S=>N(S)),o=m.useRef(!1),d=v?h||!!v.closest("form"):!0;return e.jsxs(er,{scope:t,checked:c,disabled:x,children:[e.jsx(T.button,{type:"button",role:"radio","aria-checked":c,"data-state":Se(c),"data-disabled":x?"":void 0,disabled:x,value:u,...y,ref:j,onClick:Y(s.onClick,S=>{c||b?.(),d&&(o.current=S.isPropagationStopped(),o.current||S.stopPropagation())})}),d&&e.jsx(Ne,{control:v,bubbles:!o.current,name:i,value:u,checked:c,required:p,disabled:x,form:h,style:{transform:"translateX(-100%)"}})]})});ve.displayName=re;var _e="RadioIndicator",je=m.forwardRef((s,a)=>{const{__scopeRadio:t,forceMount:i,...c}=s,p=tr(_e,t);return e.jsx(Xe,{present:i||p.checked,children:e.jsx(T.span,{"data-state":Se(p.checked),"data-disabled":p.disabled?"":void 0,...c,ref:a})})});je.displayName=_e;var rr="RadioBubbleInput",Ne=m.forwardRef(({__scopeRadio:s,control:a,checked:t,bubbles:i=!0,...c},p)=>{const x=m.useRef(null),u=Q(x,p),b=ft(t),h=Ye(a);return m.useEffect(()=>{const y=x.current;if(!y)return;const v=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(v,"checked").set;if(b!==t&&j){const o=new Event("click",{bubbles:i});j.call(y,t),y.dispatchEvent(o)}},[b,t,i]),e.jsx(T.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...c,tabIndex:-1,ref:u,style:{...c.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ne.displayName=rr;function Se(s){return s?"checked":"unchecked"}var ar=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],V="RadioGroup",[sr,qr]=J(V,[de,ye]),we=de(),ke=ye(),[ir,or]=sr(V),Ce=m.forwardRef((s,a)=>{const{__scopeRadioGroup:t,name:i,defaultValue:c,value:p,required:x=!1,disabled:u=!1,orientation:b,dir:h,loop:y=!0,onValueChange:v,...N}=s,j=we(t),o=ut(h),[d,S]=qe({prop:p,defaultProp:c??null,onChange:v,caller:V});return e.jsx(ir,{scope:t,name:i,required:x,disabled:u,value:d,onValueChange:S,children:e.jsx(pt,{asChild:!0,...j,orientation:b,dir:o,loop:y,children:e.jsx(T.div,{role:"radiogroup","aria-required":x,"aria-orientation":b,"data-disabled":u?"":void 0,dir:o,...N,ref:a})})})});Ce.displayName=V;var $e="RadioGroupItem",Re=m.forwardRef((s,a)=>{const{__scopeRadioGroup:t,disabled:i,...c}=s,p=or($e,t),x=p.disabled||i,u=we(t),b=ke(t),h=m.useRef(null),y=Q(a,h),v=p.value===c.value,N=m.useRef(!1);return m.useEffect(()=>{const j=d=>{ar.includes(d.key)&&(N.current=!0)},o=()=>N.current=!1;return document.addEventListener("keydown",j),document.addEventListener("keyup",o),()=>{document.removeEventListener("keydown",j),document.removeEventListener("keyup",o)}},[]),e.jsx(mt,{asChild:!0,...u,focusable:!x,active:v,children:e.jsx(ve,{disabled:x,required:p.required,checked:v,...b,...c,name:p.name,ref:y,onCheck:()=>p.onValueChange(c.value),onKeyDown:Y(j=>{j.key==="Enter"&&j.preventDefault()}),onFocus:Y(c.onFocus,()=>{N.current&&h.current?.click()})})})});Re.displayName=$e;var nr="RadioGroupIndicator",Ee=m.forwardRef((s,a)=>{const{__scopeRadioGroup:t,...i}=s,c=ke(t);return e.jsx(je,{...c,...i,ref:a})});Ee.displayName=nr;var Ae=Ce,Pe=Re,cr=Ee;const Ie=m.forwardRef(({className:s,...a},t)=>e.jsx(Ae,{className:Z("grid gap-2",s),...a,ref:t}));Ie.displayName=Ae.displayName;const Me=m.forwardRef(({className:s,...a},t)=>e.jsx(Pe,{ref:t,className:Z("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(cr,{className:"flex items-center justify-center",children:e.jsx(At,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Me.displayName=Pe.displayName;const lr=(s,a)=>{const t=s.toLowerCase(),i=a.toLowerCase();return t.includes("handbag")||t.includes("bag")||i.includes("handbag")||i.includes("bag")?ht:t.includes("clothing")||t.includes("clothes")||t.includes("shirt")||i.includes("clothing")||i.includes("clothes")?Ot:t.includes("jewelry")||t.includes("jewellery")||t.includes("gem")||i.includes("jewelry")||i.includes("jewellery")?Tt:t.includes("watch")||t.includes("watches")||i.includes("watch")||i.includes("watches")?Kt:t.includes("beauty")||t.includes("care")||i.includes("beauty")||i.includes("care")?Gt:t.includes("children")||t.includes("baby")||i.includes("children")||i.includes("baby")?Rt:t.includes("gaming")||t.includes("game")||i.includes("gaming")||i.includes("game")?It:t.includes("phone")||t.includes("mobile")||i.includes("phone")||i.includes("mobile")?zt:t.includes("travel")||t.includes("plane")||i.includes("travel")||i.includes("plane")?Lt:t.includes("home")||t.includes("garden")||i.includes("home")||i.includes("garden")?ue:yt},dr=({formData:s,updateFormData:a})=>{const{language:t,t:i}=O(),[c,p]=m.useState([]),[x,u]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const v=await(await fetch("/api/user/categories")).json();p(v.categories||v)}catch(y){console.error("Error loading categories:",y)}finally{u(!1)}})()},[]);const b=h=>{a({category_id:parseInt(h)})};return x?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:t==="ar"?"font-arabic":"",children:t==="ar"?"جاري تحميل الفئات...":"Loading categories..."})]})}):e.jsxs("div",{className:`space-y-6 ${t==="ar"?"rtl":"ltr"}`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:`text-lg font-semibold mb-2 ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"اختر فئة المنتج":"Select Product Category"}),e.jsx("p",{className:`text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"اختر الفئة التي تنتمي إليها منتجك":"Choose the category that best fits your product"})]}),e.jsx(Ie,{value:s.category_id?.toString()||"",onValueChange:b,className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map(h=>{const y=t==="ar"?h.name_ar:h.name_en,v=lr(y,h.slug),N=s.category_id===h.id;return e.jsxs("div",{children:[e.jsx(Me,{value:h.id.toString(),id:`category-${h.id}`,className:"peer sr-only"}),e.jsxs(et,{htmlFor:`category-${h.id}`,onClick:()=>b(h.id.toString()),className:`group flex flex-col items-center justify-center p-6 border-2 rounded-lg cursor-pointer transition-all ${N?"border-primary bg-primary/10 shadow-md":"border-muted-foreground/25 hover:border-primary hover:bg-primary/5"}`,children:[e.jsx("div",{className:`mb-3 p-3 rounded-full transition-all ${N?"bg-primary text-white":"bg-muted/20 text-muted-foreground group-hover:bg-primary group-hover:text-white"}`,children:h.icon_url?e.jsx("img",{src:h.icon_url,alt:y,className:`h-12 w-12 object-contain transition-all ${N?"brightness-0 invert":"group-hover:brightness-0 group-hover:invert"}`}):e.jsx(v,{className:"h-12 w-12"})}),e.jsx("span",{className:`text-sm font-medium text-center ${t==="ar"?"font-arabic":""} ${N?"text-primary":""}`,children:y})]})]},h.id)})})]})},ur=({formData:s,updateFormData:a})=>{const{language:t,t:i}=O(),[c,p]=m.useState([]),[x,u]=m.useState(null),[b,h]=m.useState(!0);m.useEffect(()=>{(async()=>{try{const S=await(await fetch("/api/user/subscription-plans")).json(),C=S.data||S,r=localStorage.getItem("authToken");if(r){const U=await fetch("/api/user/subscription",{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(U.ok){const D=await U.json();D.success&&u(D.data)}}p(C)}catch(d){console.error("Error loading data:",d);const C=await(await fetch("/api/user/subscription-plans")).json();p(C.data||C)}finally{h(!1)}})()},[]);const y=o=>{console.log("SelectSubscription: handlePlanSelect called with planId:",o),a({subscription_plan_id:o}),console.log("SelectSubscription: updateFormData called with subscription_plan_id:",o)},v=o=>t==="ar"?o.name_ar:o.name_en,N=o=>{const d=[];return o.ad_limit>0&&(t==="ar"?d.push(`${o.ad_limit} إعلان شهرياً`):d.push(`${o.ad_limit} ads per month`)),o.has_unlimited_featured_ads?t==="ar"?d.push("إعلانات مميزة غير محدودة"):d.push("Unlimited featured ads"):o.featured_ads_count&&o.featured_ads_count>0&&(t==="ar"?d.push(`${o.featured_ads_count} إعلان مميز`):d.push(`${o.featured_ads_count} featured ads`)),o.priority_support&&(t==="ar"?d.push("دعم أولوي"):d.push("Priority support")),o.analytics&&(t==="ar"?d.push("تحليلات متقدمة"):d.push("Analytics")),o.is_lifetime&&(t==="ar"?d.push("اشتراك مدى الحياة"):d.push("Lifetime subscription")),d.length===0&&(t==="ar"?(d.push("إعلانات أساسية"),d.push("دعم قياسي")):(d.push("Basic listings"),d.push("Standard support"))),d},j=o=>{const d=v(o).toLowerCase();return d.includes("free")||d.includes("مجاني")?gt:d.includes("silver")||d.includes("فضي")?ne:d.includes("gold")||d.includes("ذهبي")?jt:ne};return b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:t==="ar"?"font-arabic":"",children:t==="ar"?"جاري تحميل خطط الاشتراك...":"Loading subscription plans..."})]})}):e.jsxs("div",{className:`flex flex-col h-full ${t==="ar"?"rtl":"ltr"}`,children:[e.jsx("div",{className:"flex-1 space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(o=>{j(o);const d=s.subscription_plan_id===o.id,S=N(o);return e.jsx(pe,{className:`flex flex-col h-full cursor-pointer transition-all hover:shadow-lg ${d?"ring-2 ring-primary border-primary":"hover:border-primary/50"}`,onClick:()=>y(o.id),children:e.jsxs(vt,{className:"p-6 flex flex-col h-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h4",{className:`text-lg font-semibold mb-1 ${t==="ar"?"font-arabic":""}`,children:v(o)}),(o.description_en||o.description_ar)&&e.jsx("p",{className:`text-sm text-muted-foreground mb-3 ${t==="ar"?"font-arabic":""}`,children:t==="ar"?o.description_ar:o.description_en}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("span",{className:`text-2xl font-bold ${t==="ar"?"font-arabic":""}`,children:o.price===0?t==="ar"?"مجاني":"Free":`KD ${o.price}`}),o.price>0&&e.jsx("span",{className:`text-sm text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:o.is_lifetime?t==="ar"?"مدى الحياة":"Lifetime":`/${o.months_count} ${t==="ar"?"شهر":"months"}`})]}),o.price>0&&e.jsx(tt,{variant:"secondary",className:"mb-4",children:t==="ar"?"مدفوع":"Paid"})]}),S.length>0&&e.jsx("ul",{className:"space-y-2 flex-1",children:S.map((C,r)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(_t,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:`text-sm ${t==="ar"?"font-arabic":""}`,children:C.trim()})]},r))}),e.jsx(I,{className:`w-full mt-4 ${d?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-primary hover:text-primary-foreground"}`,variant:d?"default":"outline",onClick:C=>{C.stopPropagation(),console.log("SelectSubscription: Button clicked for plan:",o.id),y(o.id)},children:d?t==="ar"?"محدد":"Selected":t==="ar"?"اختر هذه الخطة":"Select This Plan"})]})},o.id)})})}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:`text-sm text-muted-foreground ${t==="ar"?"font-arabic":""}`,children:t==="ar"?"يمكنك تغيير خطة الاشتراك في أي وقت من إعدادات الحساب":"You can change your subscription plan anytime from account settings"})})]})},pr=({isOpen:s,onClose:a,onUpgrade:t,onGoHome:i,upgradeEligible:c=null,upgradeError:p="",checkingEligibility:x=!1})=>{const{language:u,t:b}=O();return e.jsx(rt,{open:s,onOpenChange:a,children:e.jsxs(at,{className:"w-[95vw] max-w-lg max-h-[90vh] overflow-y-auto mx-auto my-4 sm:my-0",children:[e.jsx(st,{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Je,{className:"w-8 h-8 text-orange-600"})}),e.jsx("div",{className:"w-full",children:e.jsx(it,{className:`text-xl sm:text-2xl font-bold text-gray-900 leading-tight ${u==="ar"?"font-arabic":""}`,children:u==="ar"?"تم استنفاد حد الإعلانات":"Ad Limit Exhausted"})})]})}),e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:`text-sm sm:text-base text-gray-600 leading-relaxed text-center px-2 ${u==="ar"?"font-arabic":""}`,children:u==="ar"?"لقد وصلت إلى الحد الأقصى من الإعلانات لهذا الشهر. يمكنك المحاولة مرة أخرى الشهر القادم أو ترقية اشتراكك للحصول على المزيد من الإعلانات.":"Your ad limit for this month has been exhausted. You can try adding next month or upgrade your subscription to get more ads."}),x?e.jsx("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200 text-center mx-2",children:e.jsx("p",{className:`text-sm text-blue-700 ${u==="ar"?"font-arabic":""}`,children:u==="ar"?"جاري التحقق من الأهلية...":"Checking eligibility..."})}):c!==null&&e.jsx("div",{className:`p-4 rounded-lg text-center mx-2 ${c?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm font-medium leading-relaxed ${c?"text-green-700":"text-red-700"} ${u==="ar"?"font-arabic":""}`,children:c?u==="ar"?"يمكنك ترقية اشتراكك":"You are eligible for upgrade":p||(u==="ar"?"لا يمكنك ترقية اشتراكك":"No upgrade options available. You already have the highest plan or no better plans exist.")})}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2 px-2",children:[e.jsxs(I,{variant:"outline",onClick:i,className:"flex items-center justify-center gap-2 w-full h-14 border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300 touch-manipulation",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{className:`font-medium text-base ${u==="ar"?"font-arabic":""}`,children:u==="ar"?"إلغاء الإدراج والعودة للرئيسية":"Cancel Listing and Go Home"})]}),e.jsx(I,{onClick:t,disabled:x||c===!1,className:`flex items-center justify-center gap-2 w-full h-14 font-medium text-base touch-manipulation ${x||c===!1?"bg-gray-400 text-gray-600 cursor-not-allowed border-gray-400":"bg-brand-red-600 hover:bg-brand-red-700 text-white border-brand-red-600"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{className:u==="ar"?"font-arabic":"",children:u==="ar"?"جاري التحقق...":"Checking..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Nt,{className:"w-5 h-5"}),e.jsx("span",{className:u==="ar"?"font-arabic":"",children:u==="ar"?"ترقية الاشتراك":"Upgrade Subscription"})]})})]})]})]})})},mr=()=>{const{language:s,t:a}=O();return e.jsx("div",{className:`max-w-2xl mx-auto text-center ${s==="ar"?"rtl":"ltr"}`,children:e.jsxs(pe,{className:"p-8 bg-luxury-ivory border-luxury-gold",children:[e.jsx(Ze,{className:"h-16 w-16 mx-auto mb-6 text-luxury-gold"}),e.jsx("h2",{className:`text-2xl font-bold text-luxury-black mb-4 ${s==="ar"?"font-arabic":"font-serif"}`,children:a("sell.success.title")}),e.jsx("p",{className:`text-luxury-black/80 mb-6 leading-relaxed ${s==="ar"?"font-arabic":""}`,children:a("sell.success.message")}),e.jsxs("div",{className:`bg-luxury-white p-4 rounded-lg mb-6 ${s==="ar"?"text-right":"text-left"}`,children:[e.jsx("h3",{className:`font-semibold text-luxury-black mb-2 ${s==="ar"?"font-arabic":""}`,children:a("sell.success.next-steps")}),e.jsxs("ul",{className:`space-y-1 text-sm text-luxury-black/80 ${s==="ar"?"font-arabic":""}`,children:[e.jsxs("li",{children:["• ",a("sell.success.step1")]}),e.jsxs("li",{children:["• ",a("sell.success.step2")]}),e.jsxs("li",{children:["• ",a("sell.success.step3")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(I,{onClick:()=>w.visit("/profile"),className:"bg-luxury-black text-luxury-white hover:bg-luxury-gold hover:text-luxury-black",children:[e.jsx(St,{className:`h-4 w-4 ${s==="ar"?"ml-2":"mr-2"}`}),e.jsx("span",{className:s==="ar"?"font-arabic":"",children:a("sell.success.view-listings")})]}),e.jsxs(I,{variant:"outline",onClick:()=>{localStorage.removeItem("sell-draft"),w.visit("/sell/category")},className:"border-luxury-black text-luxury-black hover:bg-luxury-black hover:text-luxury-white",children:[e.jsx(wt,{className:`h-4 w-4 ${s==="ar"?"ml-2":"mr-2"}`}),e.jsx("span",{className:s==="ar"?"font-arabic":"",children:a("sell.success.create-another")})]})]})]})})},P=[{id:1,path:"category",titleKey:"sell.step1.title"},{id:2,path:"details",titleKey:"sell.step2.title"},{id:3,path:"subscription",titleKey:"sell.step3.title"},{id:4,path:"submitted",titleKey:"sell.step4.title"}],fr=({step:s="category"})=>{const{language:a,t}=O(),{isAuthenticated:i,user:c}=Qe(),{toast:p}=ct(),[x,u]=m.useState(!1),[b,h]=m.useState(!1),[y,v]=m.useState(null),[N,j]=m.useState(""),[o,d]=m.useState(!1),[S,C]=m.useState(()=>localStorage.getItem("sell-upgrade-mode")==="true"),[r,U]=m.useState(()=>{const n=localStorage.getItem("sell-draft");return n?JSON.parse(n):{}}),[D,hr]=m.useState(r.draftAdId||null),[z,Te]=m.useState(null),[W,ae]=m.useState(!1),k=P.find(n=>n.path===s)?.id||1;m.useEffect(()=>{i?De():u(!0)},[i]),m.useEffect(()=>{Object.keys(r).length>0&&localStorage.setItem("sell-draft",JSON.stringify(r))},[r]);const B=n=>{console.log("SellWizard: updateFormData called with newData:",n),U(l=>{const g={...l,...n};return console.log("SellWizard: updated formData:",g),g})},De=async()=>{if(i)try{const n=localStorage.getItem("authToken");if(!n)return;const l=await fetch("/api/user/subscription",{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(l.ok){const g=await l.json();g.success&&Te(g.data)}}catch(n){console.error("Error fetching user subscription:",n)}},Le=async n=>{if(D)try{const l=localStorage.getItem("authToken");if(!l)return;(await fetch(`/api/user/ads/${D}/current-step`,{method:"PATCH",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({current_step:n})})).ok||console.error("Failed to update current step")}catch(l){console.error("Error updating current step:",l)}},L=async()=>{try{console.log("Checking upgrade eligibility"),d(!0);const n=localStorage.getItem("authToken");if(!n)return;const g=await(await fetch("/api/user/subscription-plans/upgrade-eligibility",{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).json();g.success?(v(g.eligible),g.eligible||j(g.message),h(!0)):(v(!1),j(g.message||"Failed to check upgrade eligibility"),h(!0))}catch(n){console.error("Error checking upgrade eligibility:",n),v(!1),j("Failed to check upgrade eligibility"),h(!0)}finally{d(!1)}},Fe=async()=>{if(k===2){ae(!0);try{console.log("User subscription:",z);const n=z?.is_active&&new Date(z.expires_at)>new Date,l=(z?.usable_ad_for_this_month??0)>0;if(n&&l){console.log("User has active subscription, creating active ad..."),await se(),w.visit("/sell/submitted");return}else if(n&&!l){await L();return}else{w.visit("/sell/subscription");return}}finally{ae(!1)}}if(k<P.length){const n=k+1;await Le(n);const l=P.find(g=>g.id===n);l&&w.visit(`/sell/${l.path}`)}},se=async()=>{try{const n=localStorage.getItem("authToken");if(!n){console.error("No auth token found");return}const l=new FormData;r.category_id&&l.append("category_id",r.category_id.toString()),r.title_en&&l.append("title_en",r.title_en),r.title_ar&&l.append("title_ar",r.title_ar),r.description_en&&l.append("description_en",r.description_en),r.description_ar&&l.append("description_ar",r.description_ar),r.product_details_en&&l.append("product_details_en",r.product_details_en),r.product_details_ar&&l.append("product_details_ar",r.product_details_ar),r.condition_id&&l.append("condition_id",r.condition_id.toString()),r.governorate_id&&l.append("governorate_id",r.governorate_id.toString()),r.price&&l.append("price",r.price),r.price_type_id&&l.append("price_type_id",r.price_type_id.toString()),r.is_negotiable!==void 0&&l.append("is_negotiable",r.is_negotiable?"1":"0"),r.subscription_plan_id!==void 0&&l.append("subscription_plan_id",r.subscription_plan_id.toString()),r.images&&r.images.forEach((f,$)=>{if(f instanceof File)l.append(`images[${$}]`,f);else if(typeof f=="string")if(f.startsWith("data:image/"))try{const R=atob(f.split(",")[1]),A=f.split(",")[0].split(":")[1].split(";")[0],F=new ArrayBuffer(R.length),G=new Uint8Array(F);for(let M=0;M<R.length;M++)G[M]=R.charCodeAt(M);const q=new Blob([F],{type:A}),X=new File([q],`image_${$}.jpg`,{type:A});l.append(`images[${$}]`,X)}catch(R){console.error("Error converting base64 image:",R)}else f.startsWith("http")&&console.log("Skipping URL image:",f)}),l.append("status","active");const g=await fetch("/api/user/ads",{method:"POST",headers:{Authorization:`Bearer ${n}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:l});if(g.status===403){console.log("Received 403 Forbidden response");try{const f=await g.json();if(console.log("403 response data:",f),f.error_code==="MONTHLY_LIMIT_EXCEEDED"){console.log("Monthly limit exceeded, checking upgrade eligibility"),await L();return}else if(f.error_code==="NO_SUBSCRIPTION"){console.log("No subscription, redirecting to subscription selection"),w.visit("/sell/subscription");return}}catch(f){console.error("Error parsing 403 response:",f)}console.log("403 fallback: checking upgrade eligibility"),await L();return}const _=await g.json();if(_.success)return console.log("Ad created successfully:",_.data.ad),localStorage.removeItem("sell-draft"),_.data.ad.id;if(_.error_code==="NO_SUBSCRIPTION"){w.visit("/sell/subscription");return}else if(_.error_code==="MONTHLY_LIMIT_EXCEEDED"){await L();return}else if(_.errors){const f=Object.values(_.errors).flat();throw console.log("Validation errors:",f),p({title:a==="ar"?"خطأ في التحقق":"Validation Error",description:f.join(", "),variant:"destructive"}),new Error(f.join(", "))}else throw console.log("General error:",_.message),p({title:a==="ar"?"خطأ":"Error",description:_.message||(a==="ar"?"فشل في إنشاء الإعلان":"Failed to create ad"),variant:"destructive"}),new Error(_.message)}catch(n){throw console.error("Error creating ad:",n),p({title:a==="ar"?"خطأ":"Error",description:a==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"}),n}},Oe=()=>{k>1?(k===3&&S&&oe(),w.visit(`/sell/${P[k-2].path}`)):w.visit("/")},Ue=async()=>{try{console.log("SellWizard: handleSubmit called with formData:",r),console.log("SellWizard: subscription_plan_id:",r.subscription_plan_id);const n=localStorage.getItem("authToken");if(!n){console.error("No auth token found");return}if(S&&r.subscription_plan_id){await Ve();return}const l=await se();if(!l)return;if(r.subscription_plan_id){const _=await(await fetch(`/api/user/ads/${l}`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({subscription_plan_id:r.subscription_plan_id})})).json();if(!_.success){p({title:a==="ar"?"خطأ":"Error",description:_.message||(a==="ar"?"فشل في تعيين خطة الاشتراك":"Failed to assign subscription plan"),variant:"destructive"});return}}localStorage.removeItem("sell-draft"),w.visit("/sell/submitted")}catch(n){console.error("Error submitting ad:",n),p({title:a==="ar"?"خطأ":"Error",description:a==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"})}},ze=()=>{const n=(()=>{switch(k){case 1:return!!r.category_id;case 2:return!!(r.title_en&&r.title_ar&&r.description_en&&r.description_ar&&r.condition_id&&r.governorate_id&&r.price&&r.price_type_id&&r.images&&r.images.length>0);case 3:return console.log("SellWizard: canContinue check for step 3, subscription_plan_id:",r.subscription_plan_id),!!r.subscription_plan_id;default:return!1}})();return console.log("SellWizard: canContinue check:",{currentStep:k,formData:r,result:n}),n},Be=()=>{switch(k){case 1:return e.jsx(dr,{formData:r,updateFormData:B});case 2:return e.jsx(bt,{formData:r,updateFormData:B,isSubmitting:W});case 3:return S?e.jsx(xt,{formData:r,updateFormData:B}):e.jsx(ur,{formData:r,updateFormData:B});case 4:return e.jsx(mr,{});default:return null}},ie=P[k-1],Ge=()=>{u(!1)},He=async()=>{if(y===null){await L();return}y===!0&&(h(!1),C(!0),localStorage.setItem("sell-upgrade-mode","true"),w.visit("/sell/subscription"))},Ke=()=>{h(!1),C(!1),localStorage.removeItem("sell-upgrade-mode"),w.visit("/")},oe=()=>{C(!1),localStorage.removeItem("sell-upgrade-mode")},Ve=async()=>{try{const n=localStorage.getItem("authToken");if(!n){console.error("No auth token found");return}const g=await(await fetch("/api/user/subscription/upgrade",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({subscription_plan_id:r.subscription_plan_id})})).json();g.success?(p({title:a==="ar"?"تم الترقية بنجاح":"Upgrade Successful",description:a==="ar"?`تمت ترقية اشتراكك! حصلت على ${g.data.ad_limit_increase} إعلان إضافي`:`Your subscription has been upgraded! You received ${g.data.ad_limit_increase} extra ads`,variant:"default"}),oe(),await We("active")):p({title:a==="ar"?"خطأ في الترقية":"Upgrade Error",description:g.message||(a==="ar"?"فشل في ترقية الاشتراك":"Failed to upgrade subscription"),variant:"destructive"})}catch(n){console.error("Error upgrading subscription:",n),p({title:a==="ar"?"خطأ":"Error",description:a==="ar"?"حدث خطأ غير متوقع":"An unexpected error occurred",variant:"destructive"})}},We=async n=>{try{const l=localStorage.getItem("authToken");if(!l){console.error("No auth token found");return}let g,_;if(r.draftAdId)g=await fetch(`/api/user/ads/${r.draftAdId}`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({status:n})}),_=await g.json();else{const f=new FormData;r.category_id&&f.append("category_id",r.category_id.toString()),r.title_en&&f.append("title_en",r.title_en),r.title_ar&&f.append("title_ar",r.title_ar),r.description_en&&f.append("description_en",r.description_en),r.description_ar&&f.append("description_ar",r.description_ar),r.product_details_en&&f.append("product_details_en",r.product_details_en),r.product_details_ar&&f.append("product_details_ar",r.product_details_ar),r.condition_id&&f.append("condition_id",r.condition_id.toString()),r.governorate_id&&f.append("governorate_id",r.governorate_id.toString()),r.price&&f.append("price",r.price),r.price_type_id&&f.append("price_type_id",r.price_type_id.toString()),r.is_negotiable!==void 0&&f.append("is_negotiable",r.is_negotiable?"1":"0"),r.images&&r.images.forEach(($,R)=>{if($ instanceof File)f.append(`images[${R}]`,$);else if(typeof $=="string")if($.startsWith("data:image/"))try{const A=atob($.split(",")[1]),F=$.split(",")[0].split(":")[1].split(";")[0],G=new ArrayBuffer(A.length),q=new Uint8Array(G);for(let H=0;H<A.length;H++)q[H]=A.charCodeAt(H);const X=new Blob([G],{type:F}),M=new File([X],`image_${R}.jpg`,{type:F});f.append(`images[${R}]`,M)}catch(A){console.error("Error converting base64 image:",A)}else $.startsWith("http")&&console.log("Skipping URL image:",$)}),f.append("status",n),g=await fetch("/api/user/ads",{method:"POST",headers:{Authorization:`Bearer ${l}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:f}),_=await g.json()}if(_.success)localStorage.removeItem("sell-draft"),w.visit("/sell/submitted");else if(_.errors){const f=Object.values(_.errors).flat();p({title:a==="ar"?"خطأ في التحقق":"Validation Error",description:f.join(", "),variant:"destructive"})}else p({title:a==="ar"?"خطأ":"Error",description:_.message||(a==="ar"?"فشل في إرسال الإعلان":"Failed to submit ad"),variant:"destructive"})}catch(l){console.error("Error submitting ad:",l),p({title:a==="ar"?"خطأ":"Error",description:a==="ar"?"حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.":"An unexpected error occurred. Please try again.",variant:"destructive"})}};return i?e.jsx(kt,{children:e.jsxs("div",{className:`max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 ${a==="ar"?"rtl":"ltr"}`,children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:`text-2xl font-bold text-luxury-black ${a==="ar"?"font-arabic":"font-serif"}`,children:t("sell.wizard.title")}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t("sell.wizard.step")," ",k," ",t("sell.wizard.of")," ",P.length]})]}),e.jsx(be,{value:k/P.length*100,className:"mb-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:`text-xl font-semibold text-luxury-black mb-2 ${a==="ar"?"font-arabic":""}`,children:t(ie.titleKey)}),e.jsx("p",{className:`text-muted-foreground ${a==="ar"?"font-arabic":""}`,children:t(`${ie.titleKey}.subtitle`)})]})]}),e.jsx("div",{className:"mb-8",children:Be()}),k<4&&e.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-border",children:[e.jsxs(I,{variant:"secondary",onClick:Oe,className:"flex items-center gap-2",children:[e.jsx(dt,{className:`h-4 w-4 ${a==="ar"?"rotate-180":""}`}),e.jsx("span",{className:a==="ar"?"font-arabic":"",children:t("sell.wizard.back")})]}),e.jsx(I,{onClick:k===3?Ue:Fe,disabled:!ze()||W,className:"flex items-center gap-2",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{className:a==="ar"?"font-arabic":"",children:a==="ar"?"جاري المعالجة...":"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a==="ar"?"font-arabic":"",children:t(k===3?"sell.wizard.submit":"sell.wizard.continue")}),e.jsx(Ct,{className:`h-4 w-4 ${a==="ar"?"rotate-180":""}`})]})})]}),e.jsx(pr,{isOpen:b,onClose:()=>h(!1),onUpgrade:He,onGoHome:Ke,upgradeEligible:y,upgradeError:N,checkingEligibility:o})]})}):e.jsx(lt,{isOpen:x,onClose:()=>{u(!1),w.visit("/")},onSuccess:Ge})};function Xr({step:s="category"}){return m.useEffect(()=>{(s==="sell"||s==="")&&w.visit("/sell/category",{replace:!0})},[s]),m.useEffect(()=>{if(s==="category"){const a=localStorage.getItem("sell-draft");if(a){const t=JSON.parse(a);if(t.draftAdId){const i=t.current_step||2,p={1:"category",2:"details",3:"subscription",4:"submitted"}[i]||"details";p!=="category"&&w.visit(`/sell/${p}`,{replace:!0})}}}},[s]),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ot,{}),e.jsx("main",{className:"py-16",children:e.jsx(fr,{step:s})}),e.jsx(nt,{})]})}export{Xr as default};
